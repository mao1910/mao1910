<!-- VISITOR BADGE -->
<!-- https://github.com/hehuapei/visitor-badge -->

<img align="right" src="https://visitor-badge.laobi.icu/badge?page_id=mao1910.mao1910&left_color=%2379DAF9&right_color=%23FE6E96" />


<!-- TYPING SVG -->
<!-- https://github.com/DenverCoder1/readme-typing-svg -->

<h1 align="center">
    <img src="https://readme-typing-svg.herokuapp.com/?font=Righteous&size=35&center=true&vCenter=true&width=500&height=70&color=FE6E96&font=poppins&duration=5000&lines=Hi+There!+üëã;+I'm+Mao!;" />
</h1>

<br/>

<!-- CODE/TERMINAL ABOUT ME -->
<h1 align="center">
<img src="./assets/terminal-5.gif" alt="Terminal" />
</h1>

<br/><br/><br/>


<!-- TECHNOLOGIES LOGOS -->
<!-- https://github.com/tandpfun/skill-icons -->

<h2 align="center">üíª Languages / Frameworks / Tools ‚öíÔ∏è</h2>
<div align="center">
    <img src="https://skillicons.dev/icons?i=javascript,typescript,angular,react,html,css,scss,bootstrap,cs,java,spring" />
    <img src="https://skillicons.dev/icons?i=flutter,firebase,supabase,mysql,git,github,gitlab,vscode,idea,maven,figma" />
</div>

<br/><br/><br/>


<!-- CONTRIBUTIONS SNAKE GAME -->
<!-- https://github.com/Platane/snk -->

<div align="center">
  <h2> My Contributionssssüêç </h2>
  <br>
  <img alt="contributions-eating Snake" src="https://raw.githubusercontent.com/mao1910/mao1910/output/github-contribution-grid-snake.svg" />

  <!-- Four lines below suggested by Planate for Dark mode-->
  <picture>
  <source media="(prefers-color-scheme: dark)" srcset="github-snake-dark.svg" />
  <source media="(prefers-color-scheme: light)" srcset="github-snake.svg" />
  </picture>
  
  <br/><br/><br/>
</div>


<!-- GITHUB STATS -->
<!-- https://github.com/DenverCoder1/github-readme-streak-stats -->
<!-- https://github.com/anuraghazra/github-readme-stats -->
<!-- https://github-readme-stats-mao1910.vercel.app/ My own Vercel deployment-->

<h2 align="center"> Statsüìù </h2>
  <br>
<div align=center>
  <img width=429 src="https://github-readme-stats-mao1910.vercel.app/api?username=mao1910&count_private=true&show_icons=true&theme=dracula&rank_icon=github&hide=contribs&border_radius=10&border_color=79DAF9" alt="github stats"/>
  <img width=396 src="https://streak-stats.demolab.com/?user=mao1910&count_private=true&theme=dracula&currStreakNum=79DAF9&currStreakLabel=FE6E96&border_radius=10&border=79DAF9" alt="streak stats"/>
  <br/>
  <img src="https://github-readme-stats-mao1910.vercel.app/api/top-langs/?username=mao1910&layout=compact&theme=dracula&border_radius=10&size_weight=0.5&count_weight=0.5&border_color=79DAF9" alt="languages stats" />
</div>

<br/><br/><br/>


<!-- FOOTER -->
<!-- https://github.com/DenverCoder1/readme-typing-svg -->
<!-- https://readme-typing-svg.demolab.com/demo/ -->

<a href="https://git.io/typing-svg"><img src="https://readme-typing-svg.demolab.com?font=Poppins&pause=1000&color=FE6E96&width=535&lines=Thanks+for+dropping+by!;Feel+free+to+check+any+of+the+Socials+below+%F0%9F%91%87;Or+the+Joke+Of+The+Day+if+you're+down+for+a+giggle+%F0%9F%98%9D;Hope+to+see+you+again+%F0%9F%91%8A;Uh%3F+You're+still+here%3F;Well...+I'm+running+out+of+things+to+say...;Tell+you+what%2C+due+to+your+effort+and+perseverance%2C;I+shall+present+you+with+a+short+poem%3A;%22To+code%2C+or+not+to+code%2C+that+is+the+question%3A;Whether+'tis+nobler+in+the+IDE+to+debug;The+errors+and+issues+of+outrageous+software%2C;Or+to+take+up+the+keyboard+against+a+sea+of+bugs;And+by+coding%2C+end+them.%22;by+William+Shakespeare%2C+probably.+;Pretty+sure+that's+Hamlet's.;Alrighty%2C+this+has+been+fun.;But+I'll+restart+the+loop+now...+see+ya+soon!" alt="Typing SVG" /></a>


<!--  SOCIAL NETWORKS -->
<!-- https://github.com/alexandresanlim/Badges4-README.md-Profile -->

  <div> 
    <a href="https://www.linkedin.com/" target="_blank"><img src="https://img.shields.io/badge/-LinkedIn-%230077B5?style=for-the-badge&logo=linkedin&logoColor=white" target="_blank"></a> <!-- ADD LINKEDIN PROFILE -->
    <a href = "https://www.google.com"><img src="https://img.shields.io/badge/Portfolio-4285F4?style=for-the-badge&logo=Google-chrome&logoColor=white" target="_blank"></a> <!-- ADD PORTFOLIO WEBSITE -->
    <a href="https://discord.gg" target="_blank"><img src="https://img.shields.io/badge/Discord-7289DA?style=for-the-badge&logo=discord&logoColor=white" target="_blank"></a> <!-- ADD DISCORD -->
    <a href = "mao1910dev@gmail.com"><img src="https://img.shields.io/badge/Gmail-D14836?style=for-the-badge&logo=gmail&logoColor=white" target="_blank"></a>
  </div>


<!-- SPOTIFY PLAYING-->
<!-- https://github.com/novatorem/novatorem -->
<!-- https://spotify-now-playing-novatorem-git-main-mao1910.vercel.app/ My own Vercel deployment-->

[<img width=438px src="https://spotify-now-playing-git-main-mao1910.vercel.app//api/spotify/?border_color=FE6E96" alt="Mao Spotify Now Playing" />](https://open.spotify.com/user/31542et242zglhf42ydrtqgvuvde)


<!-- JOKE OF THE DAY -->
<!-- https://github.com/ABSphreak/readme-jokes -->
<!-- https://readme-jokes-git-master-mao1910.vercel.app/ My own Vercel deployment-->

<details>
<summary>I've got a Joke for you. Wanna hear it? üôà</summary>

<br/>

 <tr>
 <td style="padding-top:4px"><img src = "https://readme-jokes-git-master-mao1910.vercel.app/api?&theme=dracula"></td>
 </tr>

</details>


<!-- ACTIVITY -->
<!-- https://github.com/jamesgeorge007/github-activity-readme -->


<details>
<summary>‚úçÔ∏è Activity</summary>

<br/>
<!-- START_SECTION:activity -->
<!--END_SECTION:activity-->

</details>


<!-- RSS FEED -->
<!-- https://github.com/gautamkrishnar/blog-post-workflow -->


<details>
<summary>üìï &nbsp;RSS feed</summary>

<br/>

<!-- BLOG-POST-LIST:START -->
 #### - [Lidando com regress√£o visual: enfrentando desafios com Django, Selenium e Pillow](https://dev.to/eduardojm/lidando-com-regressao-visual-enfrentando-desafios-com-django-selenium-e-pillow-o8d) 
 <details><summary>Article</summary> <p>O <strong>django-image-uploader-widget</strong> √© um projeto de componente de upload de imagem para o <strong>django</strong>. Por motivos de retrocompatibilidade entre as vers√µes 3.x e 4.x do <strong>django</strong>, foi decidido implementar testes de regress√£o visual utilizando <strong>Selenium</strong> e <strong>Pillow</strong>. Nesse texto vamos trabalhar esse tema e seus desafios.</p>

<h2>
  
  
  √çndice
</h2>

<ul>
<li>Introdu√ß√£o</li>
<li>O suporte do django a suas vers√µes</li>
<li>O que √© um teste de regress√£o visual?</li>
<li>O Browser e o Selenium</li>
<li>Pillow</li>
<li>Juntando as Pe√ßas</li>
<li>
Desafios

<ul>
<li>O problema inicial</li>
<li>Altera√ß√£o nas fontes</li>
<li>Anima√ß√µes, transi√ß√µes e threshold</li>
<li>Theme Toggle</li>
</ul>


</li>
<li>Refer√™ncias</li>
</ul>

<h2>
  
  
  Introdu√ß√£o <a></a>
</h2>

<p>O <a href="https://github.com/inventare/django-image-uploader-widget">django-image-uploader-widget</a> √© um projeto de componente de upload de imagem para o <strong>django</strong>, criado para melhorar a est√©tica dos <em>uploaders</em> originais. √â mantido como open-source desde o in√≠cio, inclusive recebendo colabora√ß√µes de outros desenvolvedores.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--yMzmwO7C--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/t0pzhx6vm8kwio4xf5i9.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--yMzmwO7C--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/t0pzhx6vm8kwio4xf5i9.png" alt="Visualiza√ß√£o do Componente" width="800" height="160"></a></p>

<p>Com o lan√ßamento das vers√µes 4.x do django, o componente passou a ter diferen√ßas significativas no visual entre algumas de suas vers√µes, conforme registrado na issue <a href="https://github.com/inventare/django-image-uploader-widget/issues/96#issuecomment-1690740705">#96</a>.</p>

<p>A partir dessa diferen√ßa visual, em diferentes vers√µes do <strong>django</strong>, entra no radar do projeto a possibilidade de implementa√ß√£o de testes de regress√£o visual. Nesse artigo vamos explorar os desafios enfrentados durante essa implementa√ß√£o.</p>

<h2>
  
  
  O suporte do django a suas vers√µes <a></a>
</h2>

<p>Um ponto que vale ser levado em considera√ß√£o, para justificar a decis√£o de implementar testes de regress√£o visual, √© o fato de que o <strong>django</strong> mantem, por muito tempo, suporte a diversas de suas vers√µes (<a href="https://www.djangoproject.com/download/">Ver Refer√™ncia</a>), como na imagem:</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--xwpjDp3c--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/03mlns5lyp7k2s16drdr.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--xwpjDp3c--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/03mlns5lyp7k2s16drdr.png" alt="django supported versions roadmap" width="800" height="369"></a></p>

<h2>
  
  
  O que √© um teste de regress√£o visual? <a></a>
</h2>

<p>Como o Guilherme Ananias comenta no seu texto (<a href="https://dev.to/woovi/avoiding-ui-regressions-with-jest-49f3">Ver Refer√™ncia</a>), um teste de regress√£o visual √© um tipo de teste que ir√° garantir que qualquer altera√ß√£o no c√≥digo n√£o ir√° alterar a forma como o usu√°rio final ir√° ver√° esse componente ou p√°gina.</p>

<p>Dado o contexto de suporte a m√∫ltiplas vers√µes do <strong>django</strong> e, principalmente, do <strong>django-admin</strong>, com altera√ß√µes de estiliza√ß√£o entre as vers√µes, esse tipo de teste pode, tamb√©m, ser utilizado para garantir retrocompatibilidade entre o componente e as vers√µes do <strong>django</strong>.</p>

<h2>
  
  
  O Browser e o Selenium <a></a>
</h2>

<p>O c√≥digo desse componente j√° possu√≠a uma suite de testes, funcionais, rodando com o <strong>Selenium</strong> e o <strong>Chrome Driver</strong>. A justificativa para o uso de testes funcionais pode ser lida nas <a href="https://inventare.github.io/django-image-uploader-widget/docs/development/tests/">documenta√ß√µes do projeto</a>.</p>

<p>Tendo o browser e, mais especificamente, o <strong>selenium</strong> dispon√≠veis, √© poss√≠vel utilizar o m√©todo <code>screenshot(filename)</code> para salvar um <em>screenshot</em> de um elemento da p√°gina, conforme <a href="https://selenium-python.readthedocs.io/api.html#selenium.webdriver.remote.webelement.WebElement.screenshot">documenta√ß√£o</a>.</p>

<h2>
  
  
  Pillow <a></a>
</h2>

<p>A utiliza√ß√£o dos campos de imagem do <strong>django</strong> s√≥ √© poss√≠vel com a biblioteca <strong>Pillow</strong> instalada no projeto. Essa biblioteca traz, com a sua instala√ß√£o, m√©todos para lidar com a diferen√ßa entre imagens (<a href="https://pillow.readthedocs.io/en/stable/reference/ImageChops.html#PIL.ImageChops.difference">Ver Refer√™ncia</a>).</p>

<h2>
  
  
  Juntando as Pe√ßas <a></a>
</h2>

<p>Ao utilizar o <strong>selenium</strong> e a lib <strong>Pillow</strong> √© poss√≠vel, de forma bem simples, tirar <em>screenshot</em> dos elementos e comparar com outro <em>screenshot</em> j√° armazenado (<a href="https://github.com/inventare/django-image-uploader-widget/blob/main/utils/tests/snapshot.py#L188">ver implementa√ß√£o</a>).</p>

<h2>
  
  
  Desafios <a></a>
</h2>

<p>Foram enfrentados diversos desafios durante a implementa√ß√£o dos testes de regress√£o visual. Alguns desses desafios foram causados pela natureza das escolhas para a implementa√ß√£o desses testes e outros pela natureza do <strong>django</strong> e <strong>django-admin</strong>.</p>

<h3>
  
  
  O problema inicial <a></a>
</h3>

<p>Toda a implementa√ß√£o dos testes de regress√£o visual nasceram devido a um problema entre vers√µes do django, vide <a href="https://github.com/inventare/django-image-uploader-widget/issues/96#issuecomment-1690740705">#96</a>, onde, devido a altera√ß√£o de estilos do <strong>django-admin</strong>, adicionando <code>flexbox</code>, causou a quebra da estiliza√ß√£o.</p>

<p>Assim, √© necess√°rio dizer que um dos primeiros desafios √© da natureza do <strong>django</strong> e, principalmente, do suporte a m√∫ltiplas vers√µes do mesmo.</p>

<p>A solu√ß√£o, pra esse caso, em espec√≠fico, foi simples e corriqueira fazendo o tratamento tanto pro <strong>css</strong> das vers√µes 3.x do <strong>django-admin</strong> quanto para as novas, que utilizam <code>flexbox</code>.</p>

<h3>
  
  
  Altera√ß√£o nas fontes <a></a>
</h3>

<p>Complementando o problema inicial, logo nos primeiros testes, foi identificado uma altera√ß√£o no padr√£o visual do componente (ou <em>widget</em>), em uma das vers√µes mais recentes do <strong>django</strong>. As fontes do <em>widget</em> estavam diferentes. Ao buscar pelas <em>releases notes</em> do <strong>django</strong>, √© observado a seguinte descri√ß√£o (<a href="https://docs.djangoproject.com/en/4.2/releases/4.2/">refer√™ncia</a>):</p>

<blockquote>
<p>The admin‚Äôs font stack now prefers system UI fonts and no longer requires downloading fonts. Additionally, CSS variables are available to more easily override the default font families.</p>
</blockquote>

<p>Uma solu√ß√£o, n√£o necessariamente a melhor, por√©m a mais simples foi a de adiantar essa altera√ß√£o das fontes, para o componente de upload de imagens, independente da vers√£o do <strong>django</strong>.</p>

<h3>
  
  
  Anima√ß√µes, transi√ß√µes e threshold <a></a>
</h3>

<p>Da natureza da compara√ß√£o das imagens, junto ao fato de ser uma aplica√ß√£o <em>web</em> executando, tem-se o problema de ter alguns pixeis de diferen√ßa em algumas situa√ß√µes, provavelmente causado por anima√ß√µes e transi√ß√µes.</p>

<p>Para aguardar o fim das transi√ß√µes e anima√ß√µes, o m√©todo <code>time.sleep()</code> do Python foi utilizado. Por conta da utiliza√ß√£o do <code>time.sleep()</code> √©, natural, que o tempo de execu√ß√£o dos testes aumente significativamente.</p>

<blockquote>
<p>Nesse ponto, √© sempre importante deixar pontuado que, n√£o existe certo ou errado, ou solu√ß√£o pra todos os problemas, ou, ainda, solu√ß√£o sem contrapontos. Toda t√©cnica, ou escolha, geralmente, tem suas vantagens e desvantagens. Cabe ponderar se as vantagens superam as desvantagens no contexto ao qual se quer utilizar a ferramenta.</p>
</blockquote>

<p>Por fim, ap√≥s a implementa√ß√£o do <code>time.sleep()</code> raras se tornaram as vezes que as imagens divergiam em locais que n√£o deveriam, por√©m, por garantia, ainda foi implementado um sistema de compara√ß√£o com <em>threshold</em> (limiar) para esses casos.</p>

<h3>
  
  
  Theme Toggle <a></a>
</h3>

<p>Ainda nas <em>release notes</em> da vers√£o <strong>4.2</strong> do <strong>django</strong> √© poss√≠vel verificar a adi√ß√£o de um <em>theme toggle</em> no admin. Quando o componente foi, inicialmente, desenvolvido, as vers√µes 4.x do <em>django</em> ainda n√£o tinham assumido o status de <strong>LTS</strong>. Al√©m disso, por um tempo, apenas as manuten√ß√µes b√°sicas foram dadas ao projeto. Dados esses contextos, o componente n√£o tinha suporte a mudan√ßa de tema pela interface de usu√°rio.</p>

<p>Esse problema s√≥ foi percebido, de fato, com a implementa√ß√£o dos testes de regress√£o visual e, para a solu√ß√£o, foi aberta uma nova issue no GitHub (<a href="https://github.com/inventare/django-image-uploader-widget/issues/103">#103</a>).</p>

<p>Esse foi o √∫nico caso em que foi implementada uma condicional da vers√£o do <strong>django</strong> em que os testes estavam sendo executados:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="kn">import</span> <span class="nn">django</span>
<span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">InlineEditorUIRegressionTestCase</span><span class="p">(</span><span class="n">IUWTestCase</span><span class="p">):</span>
    <span class="c1"># ...
</span>    <span class="k">def</span> <span class="nf">test_ui_initialized_toggle_dark_theme_inverted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dark_mode</span><span class="p">()</span>

        <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">django</span><span class="p">.</span><span class="n">VERSION</span>
        <span class="k">if</span> <span class="n">major</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">minor</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span>
</code></pre>

</div>






<h2>
  
  
  Refer√™ncias <a></a>
</h2>

<p>As refer√™ncias citadas no texto, listadas:</p>

<ul>
<li><a href="https://github.com/inventare/django-image-uploader-widget">django-image-uploader-widget</a></li>
<li><a href="https://github.com/inventare/django-image-uploader-widget/issues/96#issuecomment-1690740705">django-image-uploader-widget#96</a></li>
<li><a href="https://www.djangoproject.com/download/">Download - Django</a></li>
<li><a href="https://dev.to/woovi/avoiding-ui-regressions-with-jest-49f3">Avoiding UI Regressions With Jest</a></li>
<li><a href="https://inventare.github.io/django-image-uploader-widget/docs/development/tests/">Tests - django-image-uploader-widget docs</a></li>
<li><a href="https://selenium-python.readthedocs.io/api.html#selenium.webdriver.remote.webelement.WebElement.screenshot">Selenium Docs</a></li>
<li><a href="https://pillow.readthedocs.io/en/stable/reference/ImageChops.html#PIL.ImageChops.difference">Pillow Docs</a></li>
<li><a href="https://github.com/inventare/django-image-uploader-widget/blob/main/utils/tests/snapshot.py#L188">django-image-uploader-widget/snapshot.py</a></li>
<li><a href="https://docs.djangoproject.com/en/4.2/releases/4.2/">Django - Django 4.2 Release</a></li>
<li><a href="https://github.com/inventare/django-image-uploader-widget/issues/103">django-image-uploader-widget#103</a></li>
</ul>




<p>Foto de <a href="https://unsplash.com/pt-br/@buudkaanaa?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Budka Damdinsuren</a> na <a href="https://unsplash.com/pt-br/fotografias/xihqiK6rD9k?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p>

 </details> 
 <hr /> 

 #### - [Dark Mode with Next.js, TypeScript, Styled Components and Redux ToolkitüîØüîÆ](https://dev.to/koyablue/dark-mode-with-nextjs-typescript-styled-components-and-redux-toolkit-3863) 
 <details><summary>Article</summary> <p>Hi üëã<br>
Thank you for taking time to read this article!</p>

<p>One of the most common features we implement is dark mode. However, after implementing dark mode once in a project, it's easy to forget how it was implemented because there's no opportunity to implement it for a while. <br>
So I decided to put together an article on the method I use most often so that everyone can check it anytime!</p>
<h2>
  
  
  Table of Contents
</h2>

<p>¬†1. Tech stack<br>
¬†2. Step-by-step implementation</p>

<p>¬†¬†¬†¬†¬†¬† 2.1. Configs, constants and types for color themes</p>

<p>¬†¬†¬†¬†¬†¬† 2.2. Set up Redux Toolkit</p>

<p>¬†¬†¬†¬†¬†¬† 2.3. Utility functions to handle color theme cookie</p>

<p>¬†¬†¬†¬†¬†¬† 2.4. Implement useColorTheme custom hook</p>

<p>¬†¬†¬†¬†¬†¬† 2.5. Configure RTK and Styled Components in _app.tsx<br>
¬†3. Let's implement dark mode toggle switch</p>
<h2>
  
  
  Tech stack
</h2>

<p>The language, libraries and frameworks used for the implementation are as follows:</p>

<ul>
<li>Next.js</li>
<li>TypeScript</li>
<li>Styled Components</li>
<li>Redux Toolkit</li>
<li>cookies-next</li>
</ul>
<h2>
  
  
  Step-by-step implementation
</h2>
<h3>
  
  
  Configs, constants and types for color themes
</h3>

<p>First, let's define the constants and types needed to manage the color theme.<br>
in <code>const/colorTheme.ts</code><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="c1">// const/colorTheme.ts</span>

<span class="c1">// Types of available color themes</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">colorThemeNames</span> <span class="o">=</span> <span class="p">[</span>
  <span class="dl">'</span><span class="s1">light</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">dark</span><span class="dl">'</span><span class="p">,</span>
<span class="p">]</span> <span class="k">as</span> <span class="kd">const</span><span class="p">;</span>

<span class="c1">// Can't use type ColorThemeName because of circular dependency</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">defaultColorThemeName</span><span class="p">:</span> <span class="k">typeof</span> <span class="nx">colorThemeNames</span><span class="p">[</span><span class="kr">number</span><span class="p">]</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">light</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Cookie key for color theme</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">colorThemeCookieName</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">myAppColorTheme</span><span class="dl">'</span><span class="p">;</span>

</code></pre>

</div>



<p>and</p>

<p>in <code>types/colorTheme.ts</code><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="c1">// types/colorTheme.ts</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">colorThemeNames</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../const/colorTheme</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">type</span> <span class="nx">ColorThemeStyle</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">colors</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">text</span><span class="p">:</span> <span class="kr">string</span>
    <span class="na">background</span><span class="p">:</span> <span class="kr">string</span>
    <span class="na">componentBackground</span><span class="p">:</span> <span class="kr">string</span>
    <span class="na">border</span><span class="p">:</span> <span class="kr">string</span>
    <span class="na">info</span><span class="p">:</span> <span class="kr">string</span>
    <span class="na">infoBg</span><span class="p">:</span> <span class="kr">string</span>
    <span class="na">danger</span><span class="p">:</span> <span class="kr">string</span>
    <span class="na">dangerBg</span><span class="p">:</span> <span class="kr">string</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">type</span> <span class="nx">ColorThemeName</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">colorThemeNames</span><span class="p">[</span><span class="kr">number</span><span class="p">];</span>

<span class="cm">/**
 * Type guard for ColorThemeName
 *
 * @param {unknown} val
 * @return {*}  {val is ColorThemeName}
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">isColorThemeName</span> <span class="o">=</span> <span class="p">(</span><span class="nx">val</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">):</span> <span class="nx">val</span> <span class="k">is</span> <span class="nx">ColorThemeName</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="nx">colorThemeNames</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">val</span> <span class="k">as</span> <span class="nx">ColorThemeName</span><span class="p">)</span>
<span class="p">);</span>

</code></pre>

</div>



<p>Also we need to modify <code>DefaultTheme</code> type in <code>styled.d.ts</code> like this.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="c1">// styled.d.ts</span>

<span class="k">import</span> <span class="dl">'</span><span class="s1">styled-components</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ColorThemeStyle</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./types/colorTheme</span><span class="dl">'</span><span class="p">;</span>

<span class="kr">declare</span> <span class="kr">module</span> <span class="dl">'</span><span class="s1">styled-components</span><span class="dl">'</span> <span class="p">{</span>
  <span class="k">export</span> <span class="kr">interface</span> <span class="nx">DefaultTheme</span> <span class="kd">extends</span> <span class="nx">ColorThemeStyle</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre>

</div>



<p>It's convenient to create variables for the colors we will use.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="c1">// const/styles/colors.tsx</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">dryadBark</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#37352f</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// light theme string color</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">white</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#ffffff</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// light theme component color</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">errigalWhite</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#f6f6f9</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// light theme background color</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">gainsboro</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#d9d9d9</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// light theme border color</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">coralRed</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#f93e3d</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// common danger color</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">translucentUnicorn</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#fcecee</span><span class="dl">'</span><span class="p">;</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">softPetals</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#e9f6ef</span><span class="dl">'</span><span class="p">;</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">vegetation</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#48cd90</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// common info color</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">stonewallGrey</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#c3c2c1</span><span class="dl">'</span><span class="p">;</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">astrograniteDebris</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#3b414a</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// dark theme border color</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">aswadBlack</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#141519</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// dark theme background color</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">washedBlack</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#202528</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// dark theme component background color</span>

</code></pre>

</div>



<p>(I used <a href="https://github.com/meodai/color-names">this</a> library to name these variables.)</p>

<p>Then declare color theme objects, default theme.<br>
<code>config/styles/colorTheme.ts</code><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ColorThemeStyle</span><span class="p">,</span> <span class="nx">ColorThemeName</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../types/colorTheme</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// colors</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">dryadBark</span><span class="p">,</span>
  <span class="nx">white</span><span class="p">,</span>
  <span class="nx">errigalWhite</span><span class="p">,</span>
  <span class="nx">gainsboro</span><span class="p">,</span>
  <span class="nx">coralRed</span><span class="p">,</span>
  <span class="nx">vegetation</span><span class="p">,</span>
  <span class="nx">astrograniteDebris</span><span class="p">,</span>
  <span class="nx">aswadBlack</span><span class="p">,</span>
  <span class="nx">washedBlack</span><span class="p">,</span>
  <span class="nx">softPetals</span><span class="p">,</span>
  <span class="nx">translucentUnicorn</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../const/styles/colors</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">defaultColorThemeName</span><span class="p">:</span> <span class="nx">ColorThemeName</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">light</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">lightTheme</span><span class="p">:</span> <span class="nx">ColorThemeStyle</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">colors</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">text</span><span class="p">:</span> <span class="nx">dryadBark</span><span class="p">,</span>
    <span class="na">background</span><span class="p">:</span> <span class="nx">errigalWhite</span><span class="p">,</span>
    <span class="na">componentBackground</span><span class="p">:</span> <span class="nx">white</span><span class="p">,</span>
    <span class="na">border</span><span class="p">:</span> <span class="nx">gainsboro</span><span class="p">,</span>
    <span class="na">info</span><span class="p">:</span> <span class="nx">vegetation</span><span class="p">,</span>
    <span class="na">infoBg</span><span class="p">:</span> <span class="nx">softPetals</span><span class="p">,</span>
    <span class="na">danger</span><span class="p">:</span> <span class="nx">coralRed</span><span class="p">,</span>
    <span class="na">dangerBg</span><span class="p">:</span> <span class="nx">translucentUnicorn</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">darkTheme</span><span class="p">:</span> <span class="nx">ColorThemeStyle</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">colors</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">text</span><span class="p">:</span> <span class="nx">white</span><span class="p">,</span>
    <span class="na">background</span><span class="p">:</span> <span class="nx">aswadBlack</span><span class="p">,</span>
    <span class="na">componentBackground</span><span class="p">:</span> <span class="nx">washedBlack</span><span class="p">,</span>
    <span class="na">border</span><span class="p">:</span> <span class="nx">astrograniteDebris</span><span class="p">,</span>
    <span class="na">info</span><span class="p">:</span> <span class="nx">vegetation</span><span class="p">,</span>
    <span class="na">infoBg</span><span class="p">:</span> <span class="nx">softPetals</span><span class="p">,</span>
    <span class="na">danger</span><span class="p">:</span> <span class="nx">coralRed</span><span class="p">,</span>
    <span class="na">dangerBg</span><span class="p">:</span> <span class="nx">translucentUnicorn</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">themeNameStyleMap</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">ColorThemeName</span><span class="p">]:</span> <span class="nx">ColorThemeStyle</span> <span class="p">}</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">light</span><span class="p">:</span> <span class="nx">lightTheme</span><span class="p">,</span>
  <span class="na">dark</span><span class="p">:</span> <span class="nx">darkTheme</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">defaultColorThemeStyle</span> <span class="o">=</span> <span class="nx">themeNameStyleMap</span><span class="p">[</span><span class="nx">defaultColorThemeName</span><span class="p">];</span>

</code></pre>

</div>



<h3>
  
  
  Set up Redux Toolkit
</h3>

<p>The state for dark mode must be managed globally. So let's use Redux Toolkit to manage global state.<br>
We are going to create <code>colorThemeSlice</code>, typed <code>useDispatch</code>, typed <code>useSelector</code> and configure <code>store</code>.</p>

<p><code>stores/slices/colorThemeSlice.ts</code><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createSlice</span><span class="p">,</span> <span class="nx">PayloadAction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@reduxjs/toolkit</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// "type" is needed. If no "type", circular dependency error arise</span>
<span class="c1">// https://stackoverflow.com/questions/63923025/how-to-fix-circular-dependencies-of-slices-with-the-rootstate</span>
<span class="k">import</span> <span class="kd">type</span> <span class="p">{</span> <span class="nx">RootState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../store</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ColorThemeName</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../types/colorTheme</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">defaultColorThemeName</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../const/colorTheme</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">type</span> <span class="nx">ColorThemeState</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">theme</span><span class="p">:</span> <span class="nx">ColorThemeName</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">initialState</span><span class="p">:</span> <span class="nx">ColorThemeState</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">theme</span><span class="p">:</span> <span class="nx">defaultColorThemeName</span><span class="p">,</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">colorThemeSlice</span> <span class="o">=</span> <span class="nx">createSlice</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">colorTheme</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">initialState</span><span class="p">,</span>
  <span class="na">reducers</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">updateColorTheme</span><span class="p">:</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="na">action</span><span class="p">:</span> <span class="nx">PayloadAction</span><span class="o">&lt;</span><span class="nx">ColorThemeName</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">theme</span> <span class="o">=</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span><span class="p">;</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">});</span>

<span class="c1">// selectors</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">selectColorTheme</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">RootState</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">colorTheme</span><span class="p">.</span><span class="nx">theme</span><span class="p">;</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">colorThemeSlice</span><span class="p">.</span><span class="nx">reducer</span><span class="p">;</span>

<span class="c1">// actions</span>
<span class="k">export</span> <span class="kd">const</span> <span class="p">{</span>
  <span class="nx">updateColorTheme</span><span class="p">,</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">colorThemeSlice</span><span class="p">.</span><span class="nx">actions</span><span class="p">;</span>

</code></pre>

</div>



<p><code>stores/store.ts</code><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="c1">// https://redux-toolkit.js.org/tutorials/typescript</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">configureStore</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@reduxjs/toolkit</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// reducers</span>
<span class="k">import</span> <span class="nx">colorThemeReducer</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./slices/colorThemeSlice</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">configureStore</span><span class="p">({</span>
  <span class="na">reducer</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">colorTheme</span><span class="p">:</span> <span class="nx">colorThemeReducer</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">});</span>

<span class="k">export</span> <span class="kd">type</span> <span class="nx">RootState</span> <span class="o">=</span> <span class="nx">ReturnType</span><span class="o">&lt;</span><span class="k">typeof</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">type</span> <span class="nx">AppDispatch</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">;</span>

</code></pre>

</div>



<p><code>stores/hooks.ts</code><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="c1">// https://redux-toolkit.js.org/tutorials/typescript</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">useDispatch</span><span class="p">,</span> <span class="nx">useSelector</span><span class="p">,</span> <span class="nx">TypedUseSelectorHook</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-redux</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">RootState</span><span class="p">,</span> <span class="nx">AppDispatch</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./store</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">useAppDispatch</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">AppDispatch</span> <span class="o">=</span> <span class="nx">useDispatch</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">useAppSelector</span><span class="p">:</span> <span class="nx">TypedUseSelectorHook</span><span class="o">&lt;</span><span class="nx">RootState</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">useSelector</span><span class="p">;</span>

</code></pre>

</div>



<h3>
  
  
  Utility functions to handle color theme cookie
</h3>

<p>Dark mode must persists even when the page is refreshed. To achieve this, we are going to use cookie.</p>

<p><code>utils/cookie/colorTheme.ts</code><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">getCookie</span><span class="p">,</span> <span class="nx">setCookie</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">cookies-next</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">OptionsType</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">cookies-next/lib/types</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">colorThemeCookieName</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../const/colorTheme</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">ColorThemeName</span><span class="p">,</span> <span class="nx">isColorThemeName</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../types/colorTheme</span><span class="dl">'</span><span class="p">;</span>

<span class="cm">/**
 * Set color theme cookie to persist color theme config
 *
 * @param {ColorThemeName} value
 * @param {OptionsType} [options]
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">setColorThemeCookie</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nx">ColorThemeName</span><span class="p">,</span> <span class="nx">options</span><span class="p">?:</span> <span class="nx">OptionsType</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setCookie</span><span class="p">(</span><span class="nx">colorThemeCookieName</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**
 *
 *
 * @param {OptionsType} [options]
 * @return {string}  {string}
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">getColorThemeCookie</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">?:</span> <span class="nx">OptionsType</span><span class="p">):</span> <span class="kr">string</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">colorThemeCookie</span> <span class="o">=</span> <span class="nx">getCookie</span><span class="p">(</span><span class="nx">colorThemeCookieName</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">isColorThemeName</span><span class="p">(</span><span class="nx">colorThemeCookie</span><span class="p">)</span> <span class="p">?</span> <span class="nx">colorThemeCookie</span> <span class="p">:</span> <span class="dl">''</span><span class="p">;</span>
<span class="p">};</span>

</code></pre>

</div>



<h3>
  
  
  Implement useColorTheme custom hook
</h3>

<p>In the implementation, we'll need to switch color themes or retrieve the current color theme. Let's put those logics into a custom hook so that they can be called in every components.</p>

<p><code>hooks/useColorTheme.ts</code><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">defaultColorThemeName</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../const/colorTheme</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">getColorThemeCookie</span><span class="p">,</span> <span class="nx">setColorThemeCookie</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../utils/cookie/colorTheme</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">useAppDispatch</span><span class="p">,</span> <span class="nx">useAppSelector</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../stores/hooks</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">selectColorTheme</span><span class="p">,</span> <span class="nx">updateColorTheme</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../stores/slices/colorThemeSlice</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">themeNameStyleMap</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../config/styles/colorThemes</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">ColorThemeName</span><span class="p">,</span> <span class="nx">ColorThemeStyle</span><span class="p">,</span> <span class="nx">isColorThemeName</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../types/colorTheme</span><span class="dl">'</span><span class="p">;</span>

<span class="cm">/**
 * Custom hook for handling color themes
 *
 */</span>
<span class="kd">const</span> <span class="nx">useColorTheme</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">dispatch</span> <span class="o">=</span> <span class="nx">useAppDispatch</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">currentColorTheme</span> <span class="o">=</span> <span class="nx">useAppSelector</span><span class="p">(</span><span class="nx">selectColorTheme</span><span class="p">);</span>

  <span class="cm">/**
   * Set color theme cookie and state
   *
   * @param {ColorThemeName} colorThemeName
   */</span>
  <span class="kd">const</span> <span class="nx">setColorTheme</span> <span class="o">=</span> <span class="p">(</span><span class="na">colorThemeName</span><span class="p">:</span> <span class="nx">ColorThemeName</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setColorThemeCookie</span><span class="p">(</span><span class="nx">colorThemeName</span><span class="p">);</span>
    <span class="nx">dispatch</span><span class="p">(</span><span class="nx">updateColorTheme</span><span class="p">(</span><span class="nx">colorThemeName</span><span class="p">));</span>
  <span class="p">};</span>

  <span class="cm">/**
   * Initialize color theme cookie and state
   *
   * @return {void}
   */</span>
  <span class="kd">const</span> <span class="nx">initColorTheme</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">currentColorThemeCookie</span> <span class="o">=</span> <span class="nx">getColorThemeCookie</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">currentColorThemeCookie</span> <span class="o">||</span> <span class="o">!</span><span class="nx">isColorThemeName</span><span class="p">(</span><span class="nx">currentColorThemeCookie</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">setColorTheme</span><span class="p">(</span><span class="nx">defaultColorThemeName</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">dispatch</span><span class="p">(</span><span class="nx">updateColorTheme</span><span class="p">(</span><span class="nx">currentColorThemeCookie</span><span class="p">));</span>
  <span class="p">};</span>

  <span class="cm">/**
   *
   *
   * @return {*} ColorTheme
   */</span>
  <span class="kd">const</span> <span class="nx">getCurrentColorThemeState</span> <span class="o">=</span> <span class="p">():</span> <span class="nx">ColorTheme</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="nx">currentColorThemeState</span>
  <span class="p">);</span>

  <span class="cm">/**
   *
   *
   * @return {*}  {ColorThemeStyle}
   */</span>
  <span class="kd">const</span> <span class="nx">getCurrentColorThemeStyle</span> <span class="o">=</span> <span class="p">():</span> <span class="nx">ColorThemeStyle</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="nx">themeNameStyleMap</span><span class="p">[</span><span class="nx">currentColorTheme</span><span class="p">]</span>
  <span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">setColorTheme</span><span class="p">,</span>
    <span class="nx">initColorTheme</span><span class="p">,</span>
    <span class="nx">getCurrentColorThemeState</span><span class="p">,</span>
    <span class="nx">getCurrentColorThemeStyle</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">useColorTheme</span><span class="p">;</span>

</code></pre>

</div>



<h3>
  
  
  Configure RTK and Styled Components in _app.tsx
</h3>

<p>We've implemented so many functions and logic up to this point, but as it stands, we can't use them yet.<br>
Let's edit _app.tsx to make sure Redux Toolkit and Styled Components are available for use.</p>

<p><code>pages/_app.tsx</code><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">ReactElement</span><span class="p">,</span> <span class="nx">ReactNode</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Next</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">NextPage</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Router</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/router</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="kd">type</span> <span class="p">{</span> <span class="nx">AppProps</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/app</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Libraries</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Provider</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-redux</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ThemeProvider</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">styled-components</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">store</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../stores/store</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">GlobalStyle</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../components/globalstyles</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">useColorTheme</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../hooks/useColorTheme</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Layout configuration doc</span>
<span class="c1">// https://nextjs.org/docs/pages/building-your-application/routing/pages-and-layouts#with-typescript</span>

<span class="k">export</span> <span class="kd">type</span> <span class="nx">NextPageWithLayout</span><span class="o">&lt;</span><span class="nx">P</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">IP</span> <span class="o">=</span> <span class="nx">P</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">NextPage</span><span class="o">&lt;</span><span class="nx">P</span><span class="p">,</span> <span class="nx">IP</span><span class="o">&gt;</span> <span class="o">&amp;</span> <span class="p">{</span>
  <span class="nx">getLayout</span><span class="p">?:</span> <span class="p">(</span><span class="na">page</span><span class="p">:</span> <span class="nx">ReactElement</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">ReactNode</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">type</span> <span class="nx">AppPropsWithLayout</span> <span class="o">=</span> <span class="nx">AppProps</span> <span class="o">&amp;</span> <span class="p">{</span>
  <span class="na">Component</span><span class="p">:</span> <span class="nx">NextPageWithLayout</span>
  <span class="na">router</span><span class="p">:</span> <span class="nx">Router</span> <span class="c1">// Error if this property doesn't exist</span>
<span class="p">};</span>

<span class="cm">/**
 *
 *
 * @param {AppPropsWithLayout} { Component, pageProps }
 * @return {*} JSX.Element
 */</span>
<span class="kd">const</span> <span class="nx">WithThemeProviderComponent</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">pageProps</span> <span class="p">}:</span> <span class="nx">AppPropsWithLayout</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">initColorTheme</span><span class="p">,</span> <span class="nx">getCurrentColorThemeStyle</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useColorTheme</span><span class="p">();</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">initColorTheme</span><span class="p">();</span>
  <span class="p">},</span> <span class="p">[]);</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">ThemeProvider</span> <span class="nx">theme</span><span class="o">=</span><span class="p">{</span><span class="nx">getCurrentColorThemeStyle</span><span class="p">()}</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">GlobalStyle</span> <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="nx">Component</span> <span class="p">{...</span><span class="nx">pageProps</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/ThemeProvider</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">pageProps</span><span class="p">,</span> <span class="nx">router</span> <span class="p">}:</span> <span class="nx">AppPropsWithLayout</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">getLayout</span> <span class="o">=</span> <span class="nx">Component</span><span class="p">.</span><span class="nx">getLayout</span> <span class="o">??</span> <span class="p">((</span><span class="nx">page</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">page</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">Provider</span> <span class="nx">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="nx">getLayout</span><span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">WithThemeProviderComponent</span>
          <span class="nx">Component</span><span class="o">=</span><span class="p">{</span><span class="nx">Component</span><span class="p">}</span>
          <span class="nx">pageProps</span><span class="o">=</span><span class="p">{</span><span class="nx">pageProps</span><span class="p">}</span>
          <span class="nx">router</span><span class="o">=</span><span class="p">{</span><span class="nx">router</span><span class="p">}</span>
        <span class="sr">/&gt;</span><span class="err">,
</span>      <span class="p">)}</span>
    <span class="o">&lt;</span><span class="sr">/Provider</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">};</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>

</code></pre>

</div>



<h2>
  
  
  Let's implement dark mode toggle switch
</h2>

<p>With the implementation up to this point, we've completed the necessary preparations for switching the color theme.<br>
Now, let's use <code>useColorTheme</code> to implement <code>DarkModeToggleSwitch</code> component (we'll skip detailed styling for now).</p>

<p><code>globalstyles.tsx</code><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="p">...</span>
  <span class="nx">body</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="nx">background</span><span class="o">-</span><span class="nx">color</span><span class="p">:</span> <span class="nx">$</span><span class="p">{({</span> <span class="nx">theme</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">theme</span><span class="p">.</span><span class="nx">colors</span><span class="p">.</span><span class="nx">background</span><span class="p">};</span>
    <span class="nl">color</span><span class="p">:</span> <span class="nx">$</span><span class="p">{({</span> <span class="nx">theme</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">theme</span><span class="p">.</span><span class="nx">colors</span><span class="p">.</span><span class="nx">text</span><span class="p">};</span>
    <span class="p">...</span>
  <span class="p">}</span>

<span class="p">...</span>
</code></pre>

</div>



<p><code>components/DarkModeToggleSwitch.tsx</code><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">useColorTheme</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../hooks/useColorTheme</span><span class="dl">'</span>


<span class="cm">/**
 * Dark mode &lt;-&gt; light mode toggle switch
 * Update cookie value and global state
 *
 * @return {*} JSX.Element
 */</span>
<span class="kd">const</span> <span class="nx">DarkModeToggleSwitch</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">setColorTheme</span><span class="p">,</span> <span class="nx">getCurrentColorThemeState</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useColorTheme</span><span class="p">()</span>

  <span class="kd">const</span> <span class="nx">currentColorTheme</span> <span class="o">=</span> <span class="nx">getCurrentColorThemeState</span><span class="p">()</span>

  <span class="kd">const</span> <span class="nx">isDark</span> <span class="o">=</span> <span class="nx">currentColorTheme</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">dark</span><span class="dl">'</span>

  <span class="kd">const</span> <span class="nx">toggleDarkTheme</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">isDark</span> <span class="p">?</span> <span class="nx">setColorTheme</span><span class="p">(</span><span class="dl">'</span><span class="s1">light</span><span class="dl">'</span><span class="p">)</span> <span class="p">:</span> <span class="nx">setColorTheme</span><span class="p">(</span><span class="dl">'</span><span class="s1">dark</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;&gt;</span>
      <span class="p">...</span>
      <span class="o">&lt;</span><span class="nx">input</span> <span class="kd">type</span><span class="o">=</span><span class="dl">'</span><span class="s1">checkbox</span><span class="dl">'</span> <span class="nx">checked</span><span class="o">=</span><span class="p">{</span><span class="nx">isDark</span><span class="p">}</span> <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">toggleDarkTheme</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>      <span class="p">...</span>
    <span class="o">&lt;</span><span class="sr">/</span><span class="err">&gt;
</span>  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">DarkModeToggleSwitch</span>
</code></pre>

</div>






<p>That's all.<br>
How was it? I hope this article was helpful for you.</p>

<p>There are many ways to implement color theme switching besides this article. If you have any recommended methods or articles, please share them in the comments and let me know!</p>

<p>And if you found this article helpful, please share it on social media!</p>

 </details> 
 <hr /> 

 #### - [DynamoDB Streams EventBridge Pipes Multiple Items](https://dev.to/aws-builders/dynamodb-streams-eventbridge-pipes-multiple-items-4657) 
 <details><summary>Article</summary> <p>I've written a few articles lately on EventBridge Pipes and specifically around using them with DynamoDB Streams. I've written about <a href="https://www.binaryheap.com/dynamodb-eventbridge-pipes-enrichment/">Enrichment</a>. And I've written about just straight <a href="https://www.binaryheap.com/streaming-aws-dynamodb-to-a-lambda-via-eventbridge-pipes/">Streaming</a>. I believe that using EventBridge Pipes plays a nice part in a Serverless, Event-Driven approach. So in this article, I want to explore Streaming DynamoDB to EventBridge Pipes with multiple items in one table.</p>

<p>Several of the comments I received about <a href="https://www.binaryheap.com/dynamodb-eventbridge-pipes-enrichment/">Streaming DynamoDB to EventBridge Pipes</a> were around, "What if I have multiple item collections in the same table?". I intend to show a pattern for handling that exact problem in this article. At the bottom, you'll find a working code sample that you can deploy and build on top of. I've used this exact setup in production, so rest assured that this is a great base to start from.</p>

<h2>
  
  
  Architecture
</h2>

<p>Let's start with defining the setup that I'll be walking through.</p>

<ul>
<li>  DynamoDB Table with 2 Item Types

<ul>
<li>  Patient</li>
<li>  Address</li>
</ul>


</li>
<li>  DynamoDB Stream connected to an EventBridge Pipe</li>
<li>  EB Pipe will

<ul>
<li>  Filter</li>
<li>  Enrich</li>
<li>  Put into the EventBridge Default Bus</li>
</ul>


</li>
<li>  EB Rules carved out for

<ul>
<li>  Lambda Handler for Patient</li>
<li>  Lambda Handler for Address</li>
</ul>


</li>
</ul>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--TwVlHZ52--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://www.binaryheap.com/wp-content/uploads/2023/09/Multi-Arch.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--TwVlHZ52--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://www.binaryheap.com/wp-content/uploads/2023/09/Multi-Arch.png" alt="EventBridge Pipe Stream" width="800" height="256"></a></p>

<h2>
  
  
  Step Through the Code
</h2>

<h3>
  
  
  DynamoDB Table
</h3>

<p>The DynamoDB Table I'm working from is going to contain multiple item types. This can be described as Single-Table design, Multi-Item Collection Design or whatever you like. The point is, that DynamoDB is great at storing things that are related in the same table. I'm defining an <code>id</code> field as the Partition Key and then <code>sk</code> as the Range Key.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">this</span><span class="p">.</span><span class="nx">_table</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Table</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">billingMode</span><span class="p">:</span> <span class="nx">BillingMode</span><span class="p">.</span><span class="nx">PAY_PER_REQUEST</span><span class="p">,</span>
    <span class="na">removalPolicy</span><span class="p">:</span> <span class="nx">RemovalPolicy</span><span class="p">.</span><span class="nx">DESTROY</span><span class="p">,</span>
    <span class="na">partitionKey</span><span class="p">:</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="nx">AttributeType</span><span class="p">.</span><span class="nx">STRING</span> <span class="p">},</span>
    <span class="na">sortKey</span><span class="p">:</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">sk</span><span class="dl">"</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="nx">AttributeType</span><span class="p">.</span><span class="nx">STRING</span> <span class="p">},</span>
    <span class="na">tableName</span><span class="p">:</span> <span class="s2">`Patients`</span><span class="p">,</span>
    <span class="na">encryption</span><span class="p">:</span> <span class="nx">TableEncryption</span><span class="p">.</span><span class="nx">CUSTOMER_MANAGED</span><span class="p">,</span>
    <span class="na">encryptionKey</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span>
    <span class="na">stream</span><span class="p">:</span> <span class="nx">StreamViewType</span><span class="p">.</span><span class="nx">NEW_AND_OLD_IMAGES</span><span class="p">,</span>
<span class="p">});</span>
</code></pre>

</div>



<p>Notice as well that I'm defining a <code>stream</code> that will propagate changes with New and Old images attached to the change record. This will be useful as I get into the Pipe definition.</p>

<p>A Patient will look like this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PATIENT#1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sk"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ADDRESS#1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123 Some City, Some State USAA"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"addressId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"itemType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Address"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"patientId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

</div>



<p>And an Address like this:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PATIENT#1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sk"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ADDRESS#1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123 Some City, Some State USAA"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"addressId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"itemType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Address"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"patientId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

</div>



<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5qkpO-QE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://www.binaryheap.com/wp-content/uploads/2023/09/db_records.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5qkpO-QE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://www.binaryheap.com/wp-content/uploads/2023/09/db_records.png" alt="Table Records" width="800" height="181"></a></p>

<h3>
  
  
  EventBridge Pipe
</h3>

<p>When Streaming DynamoDB to EventBridge Pipes, the Pipe is the central player in the design. In this scenario, I'm ignoring Deletes and only dealing with DynamoDB Modify and Insert change types.</p>

<h4>
  
  
  The Source
</h4>

<p>I want to first address the fact that your source component needs to have the proper IAM Permissions attached to read from the stream and decrypt the data.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">new</span> <span class="nx">PolicyDocument</span><span class="p">({</span>
    <span class="na">statements</span><span class="p">:</span> <span class="p">[</span>
        <span class="k">new</span> <span class="nx">PolicyStatement</span><span class="p">({</span>
            <span class="na">actions</span><span class="p">:</span> <span class="p">[</span>
                <span class="dl">"</span><span class="s2">dynamodb:DescribeStream</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">dynamodb:GetRecords</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">dynamodb:GetShardIterator</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">dynamodb:ListStreams</span><span class="dl">"</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="na">effect</span><span class="p">:</span> <span class="nx">Effect</span><span class="p">.</span><span class="nx">ALLOW</span><span class="p">,</span>
            <span class="na">resources</span><span class="p">:</span> <span class="p">[</span><span class="nx">table</span><span class="p">.</span><span class="nx">tableStreamArn</span><span class="o">!</span><span class="p">],</span>
        <span class="p">}),</span>
        <span class="k">new</span> <span class="nx">PolicyStatement</span><span class="p">({</span>
            <span class="na">actions</span><span class="p">:</span> <span class="p">[</span>
                <span class="dl">"</span><span class="s2">kms:Decrypt</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">kms:DescribeKey</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">kms:Encrypt</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">kms:GenerateDataKey*</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">kms:ReEncrypt*</span><span class="dl">"</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="na">resources</span><span class="p">:</span> <span class="p">[</span><span class="nx">key</span><span class="p">.</span><span class="nx">keyArn</span><span class="p">],</span>
            <span class="na">effect</span><span class="p">:</span> <span class="nx">Effect</span><span class="p">.</span><span class="nx">ALLOW</span><span class="p">,</span>
        <span class="p">}),</span>
    <span class="p">],</span>
<span class="p">});</span>
</code></pre>

</div>



<p>The next step is to configure the stream reader. I want to process 1 record at a time in addition to filtering in only the Modify and Inserts as described above.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">return</span> <span class="p">{</span>
    <span class="na">dynamoDbStreamParameters</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">startingPosition</span><span class="p">:</span> <span class="dl">"</span><span class="s2">LATEST</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">batchSize</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">filterCriteria</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">filters</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="na">pattern</span><span class="p">:</span> <span class="dl">'</span><span class="s1"> { "eventName": [ "MODIFY", "INSERT" ] }</span><span class="dl">'</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">};</span>
</code></pre>

</div>



<h4>
  
  
  The Enrichment
</h4>

<p>In this case, I want to simply strip out the DynamoDB parts of the source event down a raw <code>struct</code> in Golang that I can pass along into the EventBridge Bus. To do that, I'm going to use a Lambda function as part of the Pipe workflow.</p>

<p>The Lambda will be triggered as a Request/Response that makes this synchronous in the workflow.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">return</span> <span class="p">{</span>
    <span class="na">lambdaParameters</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">invocationType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">REQUEST_RESPONSE</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">inputTemplate</span><span class="p">:</span> <span class="s2">``</span><span class="p">,</span>
<span class="p">};</span>
</code></pre>

</div>



<p>The Lambda itself handles the shaping of the Stream Record.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight go"><code><span class="k">func</span> <span class="n">Convert</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span><span class="n">events</span><span class="o">.</span><span class="n">DynamoDBEventRecord</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">CustomEvent</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c">// the body of this function parses out the values</span>
    <span class="c">// and returns shaped record</span>
    <span class="k">if</span> <span class="n">itemType</span> <span class="o">==</span> <span class="s">"Patient"</span> <span class="p">{</span>
        <span class="n">i</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">Change</span><span class="o">.</span><span class="n">NewImage</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">Change</span><span class="o">.</span><span class="n">NewImage</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">Change</span><span class="o">.</span><span class="n">NewImage</span><span class="p">[</span><span class="s">"itemType"</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">Change</span><span class="o">.</span><span class="n">NewImage</span><span class="p">[</span><span class="s">"sk"</span><span class="p">]</span>
        <span class="n">pid</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">Change</span><span class="o">.</span><span class="n">NewImage</span><span class="p">[</span><span class="s">"patientId"</span><span class="p">]</span>

        <span class="n">change</span> <span class="o">:=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"Patient%s"</span><span class="p">,</span> <span class="n">strings</span><span class="o">.</span><span class="n">Title</span><span class="p">(</span><span class="n">strings</span><span class="o">.</span><span class="n">ToLower</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">EventName</span><span class="p">)))</span>
        <span class="k">return</span> <span class="o">&amp;</span><span class="n">CustomEvent</span><span class="p">{</span>
            <span class="n">EventType</span><span class="o">:</span>     <span class="n">change</span><span class="p">,</span>
            <span class="n">CorrelationId</span><span class="o">:</span> <span class="n">r</span><span class="o">.</span><span class="n">EventID</span><span class="p">,</span>
            <span class="n">Body</span><span class="o">:</span> <span class="o">&amp;</span><span class="n">ItemOne</span><span class="p">{</span>
                <span class="n">Id</span><span class="o">:</span>        <span class="n">i</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">Name</span><span class="o">:</span>      <span class="n">n</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">ItemType</span><span class="o">:</span>  <span class="n">t</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">Sk</span><span class="o">:</span>        <span class="n">s</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">PatientId</span><span class="o">:</span> <span class="n">pid</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
            <span class="p">}},</span> <span class="no">nil</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">itemType</span> <span class="o">==</span> <span class="s">"Address"</span> <span class="p">{</span>
        <span class="n">i</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">Change</span><span class="o">.</span><span class="n">NewImage</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">Change</span><span class="o">.</span><span class="n">NewImage</span><span class="p">[</span><span class="s">"address"</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">Change</span><span class="o">.</span><span class="n">NewImage</span><span class="p">[</span><span class="s">"itemType"</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">Change</span><span class="o">.</span><span class="n">NewImage</span><span class="p">[</span><span class="s">"sk"</span><span class="p">]</span>
        <span class="n">pid</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">Change</span><span class="o">.</span><span class="n">NewImage</span><span class="p">[</span><span class="s">"patientId"</span><span class="p">]</span>
        <span class="n">aid</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">Change</span><span class="o">.</span><span class="n">NewImage</span><span class="p">[</span><span class="s">"addressId"</span><span class="p">]</span>
        <span class="n">change</span> <span class="o">:=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"Address%s"</span><span class="p">,</span> <span class="n">strings</span><span class="o">.</span><span class="n">Title</span><span class="p">(</span><span class="n">strings</span><span class="o">.</span><span class="n">ToLower</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">EventName</span><span class="p">)))</span>
        <span class="k">return</span> <span class="o">&amp;</span><span class="n">CustomEvent</span><span class="p">{</span>
            <span class="n">EventType</span><span class="o">:</span>     <span class="n">change</span><span class="p">,</span>
            <span class="n">CorrelationId</span><span class="o">:</span> <span class="n">r</span><span class="o">.</span><span class="n">EventID</span><span class="p">,</span>
            <span class="n">Body</span><span class="o">:</span> <span class="o">&amp;</span><span class="n">ItemTwo</span><span class="p">{</span>
                <span class="n">Id</span><span class="o">:</span>        <span class="n">i</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">Address</span><span class="o">:</span>   <span class="n">n</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">ItemType</span><span class="o">:</span>  <span class="n">t</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">Sk</span><span class="o">:</span>        <span class="n">s</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">PatientId</span><span class="o">:</span> <span class="n">pid</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">AddressId</span><span class="o">:</span> <span class="n">aid</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
            <span class="p">}},</span> <span class="no">nil</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

</div>



<h4>
  
  
  The Target
</h4>

<p>Once the event has been shaped in the format that I want, it's time to send the payload to an EventBridge Bus. I'm going to shape the output into a result that I prefer.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">return</span> <span class="p">{</span>
    <span class="na">eventBridgeEventBusParameters</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">detailType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PatientChange</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">source</span><span class="p">:</span> <span class="dl">"</span><span class="s2">com.binaryheap.patient</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">inputTemplate</span><span class="p">:</span> <span class="s2">`{
            "meta": {
                "correlationId": &lt;$.eventId&gt;,
                "changeType": &lt;$.eventType&gt;
            },
            "event": &lt;$.body&gt;
        }`</span><span class="p">,</span>
<span class="p">};</span>
</code></pre>

</div>



<p>Just like with the source input, I need to grant the consumer the ability to post to EventBridge.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">return</span> <span class="k">new</span> <span class="nx">PolicyDocument</span><span class="p">({</span>
    <span class="na">statements</span><span class="p">:</span> <span class="p">[</span>
        <span class="k">new</span> <span class="nx">PolicyStatement</span><span class="p">({</span>
            <span class="na">resources</span><span class="p">:</span> <span class="p">[</span><span class="nx">busArn</span><span class="p">],</span>
            <span class="na">actions</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">events:PutEvents</span><span class="dl">"</span><span class="p">],</span>
            <span class="na">effect</span><span class="p">:</span> <span class="nx">Effect</span><span class="p">.</span><span class="nx">ALLOW</span><span class="p">,</span>
        <span class="p">}),</span>
    <span class="p">],</span>
<span class="p">});</span>
</code></pre>

</div>



<h3>
  
  
  Rules to Handle Item Types
</h3>

<p>Now that I've got a Pipe publishing to EventBridge's Default Bus, I can craft some rules. When Streaming DynamoDB to EventBridge Pipes in a MultiCast scenario, my specific rules will help target Lambda functions that I want to handle the Item changes. These could also be queues or anything else you like. This is where having multiple Item Types in one table comes back together. You could have service consumers handling all changes from the Patients table or you could have specific consumers dealing with the specific Item Types. My example shows the latter. I want to be specific to highlight the pattern.</p>

<h4>
  
  
  Patient Rule
</h4>

<p>When dealing with the Patient, I might want to address something specific about that record. I first need to build an EventBridge Rule for handling the Bus message and the target I want.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">this</span><span class="p">.</span><span class="nx">_handlerOne</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GoFunction</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ItemOneHandlerFunction</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">entry</span><span class="p">:</span> <span class="dl">"</span><span class="s2">src/type-one-handler</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">functionName</span><span class="p">:</span> <span class="s2">`type-one-handler`</span><span class="p">,</span>
    <span class="na">timeout</span><span class="p">:</span> <span class="nx">Duration</span><span class="p">.</span><span class="nx">seconds</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
    <span class="na">environment</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">IS_LOCAL</span><span class="p">:</span> <span class="dl">"</span><span class="s2">false</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">LOG_LEVEL</span><span class="p">:</span> <span class="dl">"</span><span class="s2">DEBUG</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">VERSION</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">version</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">});</span>
</code></pre>

</div>



<p>This code will deploy the Lambda that will be the target for my Patient rule.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="kd">const</span> <span class="nx">rule</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rule</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ItemOnHandlerRule</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">eventPattern</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">detailType</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">PatientChange</span><span class="dl">"</span><span class="p">],</span>
        <span class="na">detail</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">meta</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">changeType</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">PatientModify</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">PatientInsert</span><span class="dl">"</span><span class="p">],</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="na">eventBus</span><span class="p">:</span> <span class="nx">EventBus</span><span class="p">.</span><span class="nx">fromEventBusArn</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="dl">"</span><span class="s2">DefaultBusItemOne</span><span class="dl">"</span><span class="p">,</span> <span class="nx">busArn</span><span class="p">),</span>
    <span class="na">ruleName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">item-one-rule</span><span class="dl">"</span><span class="p">,</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">dlq</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Queue</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ItemOneHandler-DLQ</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">rule</span><span class="p">.</span><span class="nx">addTarget</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">targets</span><span class="p">.</span><span class="nx">LambdaFunction</span><span class="p">(</span><span class="nx">handler</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">deadLetterQueue</span><span class="p">:</span> <span class="nx">dlq</span><span class="p">,</span>
    <span class="p">})</span>
<span class="p">);</span>
</code></pre>

</div>



<p>As you can notice, I'm looking for the top-level detail-type of <code>PatientChange</code>. Then I'm looking deeper into the payload for the <code>PatientInsert</code> and <code>PatientModify</code> change types. That then forwards into my Item One Lambda.</p>

<h4>
  
  
  Address Rule
</h4>

<p>Next, I build an almost identical rule, but specifically for Address.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="kd">const</span> <span class="nx">rule</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rule</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ItemTwoHandlerRule</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">eventPattern</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">detailType</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">PatientChange</span><span class="dl">"</span><span class="p">],</span>
        <span class="na">detail</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">meta</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">changeType</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">AddressModify</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">AddressInsert</span><span class="dl">"</span><span class="p">],</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="na">eventBus</span><span class="p">:</span> <span class="nx">EventBus</span><span class="p">.</span><span class="nx">fromEventBusArn</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="dl">"</span><span class="s2">DefaultBusItemTwo</span><span class="dl">"</span><span class="p">,</span> <span class="nx">busArn</span><span class="p">),</span>
    <span class="na">ruleName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">item-two-rule</span><span class="dl">"</span><span class="p">,</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">dlq</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Queue</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ItemTwoHandler-DLQ</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">rule</span><span class="p">.</span><span class="nx">addTarget</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">targets</span><span class="p">.</span><span class="nx">LambdaFunction</span><span class="p">(</span><span class="nx">handler</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">deadLetterQueue</span><span class="p">:</span> <span class="nx">dlq</span><span class="p">,</span>
    <span class="p">})</span>
<span class="p">);</span>
</code></pre>

</div>



<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--sI2HST4c--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://www.binaryheap.com/wp-content/uploads/2023/09/address_change_pattern.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--sI2HST4c--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://www.binaryheap.com/wp-content/uploads/2023/09/address_change_pattern.png" alt="Address Rule" width="800" height="173"></a></p>

<p>On the backside of my targets, I have two separate Lambdas. They are identical for this example as they just print out the payload.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight go"><code><span class="k">func</span> <span class="n">handler</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">e</span> <span class="k">interface</span><span class="p">{})</span> <span class="p">(</span><span class="k">interface</span><span class="p">{},</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">log</span><span class="o">.</span><span class="n">WithFields</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">Fields</span><span class="p">{</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="n">e</span><span class="p">,</span>
    <span class="p">})</span><span class="o">.</span><span class="n">Debug</span><span class="p">(</span><span class="s">"Printing out the body"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">e</span><span class="p">,</span> <span class="no">nil</span>
<span class="p">}</span>
</code></pre>

</div>



<p><strong>Patient Output</strong><br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--jbeoM6qn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://www.binaryheap.com/wp-content/uploads/2023/09/patient_log.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--jbeoM6qn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://www.binaryheap.com/wp-content/uploads/2023/09/patient_log.png" alt="Patient Output" width="800" height="395"></a></p>

<p><strong>Address Output</strong><br>
<a href="https://res.cloudinary.com/practicaldev/image/fetch/s--crzEGJDV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://www.binaryheap.com/wp-content/uploads/2023/09/address_log.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--crzEGJDV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://www.binaryheap.com/wp-content/uploads/2023/09/address_log.png" alt="Address Output" width="800" height="448"></a></p>

<h2>
  
  
  Notes on the Pattern
</h2>

<p>When streaming DynamoDB to EventBridge Pipes you have so many options from filtering, enriching and then ultimately the targets. I continue personally to put Pipes into my workloads as I find it performs super efficiently and is easy to set up and reason about. I also find that where I was using Step Functions for these types of workflows, I'm now defaulting to Pipes.</p>

<h2>
  
  
  Wrap Up
</h2>

<p>To pull things back together, Streaming DynamoDB has a limit of 2 consumers that you can attach to the stream. That limit isn't a big deal when you have 1 type of record in the table. You could have one stream handling Inserts and Modifies and then another Pipe to handle the Deletes. But when you have a Single-Table or Multi-Type situation, you need a few more services layered in.</p>

<p>Using EventBridge's Rules and Targets is exactly the service and capability that makes this possible. I also find that if you've got local teams with permission boundaries as well, this can be even further enhanced with an <a href="https://www.binaryheap.com/eventbus-mesh/">Event Bus Mesh</a>.</p>

<p>As always, for a [fully functioning <a href="https://github.com/benbpyle/ddb-stream-multi-cast">and working repository</a>, you can head on over to GitHub and clone it.</p>

<p>I hope this gets you a little more in your toolbox when working with DynamoDB Streams and EventBridge Pipes.</p>

<p>Happy Building!</p>

 </details> 
 <hr /> 

 #### - [Code Smell 224 - Deodorant Comments](https://dev.to/mcsee/code-smell-224-deodorant-comments-3nfk) 
 <details><summary>Article</summary> <p><em>You use nice words to excuse bad code</em></p>

<blockquote>
<p>TL;DR: Don't excuse bad code. Write a clean one!</p>
</blockquote>

<h1>
  
  
  Problems
</h1>

<ul>
<li>Readability</li>
</ul>

<h1>
  
  
  Solutions
</h1>

<ol>
<li>Rewrite the code and delete the comment</li>
</ol>

<h1>
  
  
  Context
</h1>

<p>The term comes from Martin Fowler's book "Refactoring: Improving the Design of Existing Code"</p>

<h1>
  
  
  Sample Code
</h1>

<h2>
  
  
  Wrong
</h2>



<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="c1"># This is a function that adds two numbers
</span><span class="k">def</span> <span class="nf">s</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="c1"># Now you are going to add a and b
</span>    <span class="n">res</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="c1"># And return the result
</span>    <span class="k">return</span> <span class="n">res</span>

</code></pre>

</div>

<h2>
  
  
  Right
</h2>


<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">adder</span><span class="p">,</span> <span class="n">anotherAdder</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">adder</span> <span class="o">+</span> <span class="n">anotherAdder</span>
</code></pre>

</div>


<p>If you ask ChatGPT to improve this version it will actually worsen it:</p>


<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="k">def</span> <span class="nf">calculate_sum</span><span class="p">(</span><span class="n">number1</span><span class="p">,</span> <span class="n">number2</span><span class="p">):</span>
    <span class="c1"># Calculate the sum of two numbers
</span>    <span class="n">result</span> <span class="o">=</span> <span class="n">number1</span> <span class="o">+</span> <span class="n">number2</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="c1"># In this improved version:
#
# The function name calculate_sum is more descriptive than sum, 
# making it clear that this function calculates the sum of two numbers.
# (Wrong) it is more imperative and mistakes the 'what' with the 'how'
#
# The parameter names number1 and number2 are more meaningful 
# than adder and anotherAdder, helping to indicate the purpose of each parameter.
# (wrong) They indicate type instead of role
#
# The comment # Calculate the sum of two numbers provides a clear 
# and concise explanation of what the function does, 
# making it easier for someone reading the code to understand its purpose.    
# (wrong) in fact, it is an example of deodorant and useless comment
</span></code></pre>

</div>

<h1>
  
  
  Detection
</h1>

<p>[X] Semi-Automatic </p>

<p>Most comments are code smells. </p>

<p>You can remove deodorant comments and improve the code.</p>
<h1>
  
  
  Exceptions
</h1>

<ul>
<li>Comments should only be used to describe important design decisions.</li>
</ul>
<h1>
  
  
  Tags
</h1>

<ul>
<li>Comments</li>
</ul>
<h1>
  
  
  Conclusion
</h1>

<p>Remove any meaningless comment you find in your code.</p>
<h1>
  
  
  Relations
</h1>


<div class="ltag__link">
  <a href="/mcsee" class="ltag__link__link">
    <div class="ltag__link__pic">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ykqWDKUm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://res.cloudinary.com/practicaldev/image/fetch/s--g5itNIDM--/c_fill%2Cf_auto%2Cfl_progressive%2Ch_150%2Cq_auto%2Cw_150/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/366059/d995753c-a4ef-4552-918b-f467838d01f5.png" alt="mcsee">
    </div>
  </a>
  <a href="/mcsee/code-smell-151-commented-code-5d8l" class="ltag__link__link">
    <div class="ltag__link__content">
      <h2>Code Smell 151 - Commented Code</h2>
      <h3>Maxi Contieri „Éª Jul 22 '22</h3>
      <div class="ltag__link__taglist">
        <span class="ltag__link__tag">#javascript</span>
        <span class="ltag__link__tag">#webdev</span>
        <span class="ltag__link__tag">#beginners</span>
        <span class="ltag__link__tag">#programming</span>
      </div>
    </div>
  </a>
</div>




<div class="ltag__link">
  <a href="/mcsee" class="ltag__link__link">
    <div class="ltag__link__pic">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ykqWDKUm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://res.cloudinary.com/practicaldev/image/fetch/s--g5itNIDM--/c_fill%2Cf_auto%2Cfl_progressive%2Ch_150%2Cq_auto%2Cw_150/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/366059/d995753c-a4ef-4552-918b-f467838d01f5.png" alt="mcsee">
    </div>
  </a>
  <a href="/mcsee/code-smell-183-obsolete-comments-3mmo" class="ltag__link__link">
    <div class="ltag__link__content">
      <h2>Code Smell 183 - Obsolete Comments</h2>
      <h3>Maxi Contieri „Éª Dec 2 '22</h3>
      <div class="ltag__link__taglist">
        <span class="ltag__link__tag">#webdev</span>
        <span class="ltag__link__tag">#javascript</span>
        <span class="ltag__link__tag">#beginners</span>
        <span class="ltag__link__tag">#programming</span>
      </div>
    </div>
  </a>
</div>



<div class="ltag__link">
  <a href="/mcsee" class="ltag__link__link">
    <div class="ltag__link__pic">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ykqWDKUm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://res.cloudinary.com/practicaldev/image/fetch/s--g5itNIDM--/c_fill%2Cf_auto%2Cfl_progressive%2Ch_150%2Cq_auto%2Cw_150/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/366059/d995753c-a4ef-4552-918b-f467838d01f5.png" alt="mcsee">
    </div>
  </a>
  <a href="/mcsee/code-smell-146-getter-comments-3pjn" class="ltag__link__link">
    <div class="ltag__link__content">
      <h2>Code Smell 146 - Getter Comments</h2>
      <h3>Maxi Contieri „Éª Jul 2 '22</h3>
      <div class="ltag__link__taglist">
        <span class="ltag__link__tag">#javascript</span>
        <span class="ltag__link__tag">#webdev</span>
        <span class="ltag__link__tag">#beginners</span>
        <span class="ltag__link__tag">#programming</span>
      </div>
    </div>
  </a>
</div>



<div class="ltag__link">
  <a href="/mcsee" class="ltag__link__link">
    <div class="ltag__link__pic">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ykqWDKUm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://res.cloudinary.com/practicaldev/image/fetch/s--g5itNIDM--/c_fill%2Cf_auto%2Cfl_progressive%2Ch_150%2Cq_auto%2Cw_150/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/366059/d995753c-a4ef-4552-918b-f467838d01f5.png" alt="mcsee">
    </div>
  </a>
  <a href="/mcsee/code-smell-05-comment-abusers-2ba5" class="ltag__link__link">
    <div class="ltag__link__content">
      <h2>Code Smell 05 - Comment Abusers</h2>
      <h3>Maxi Contieri „Éª Oct 24 '20</h3>
      <div class="ltag__link__taglist">
        <span class="ltag__link__tag">#codenewbie</span>
        <span class="ltag__link__tag">#tutorial</span>
        <span class="ltag__link__tag">#beginners</span>
      </div>
    </div>
  </a>
</div>



<div class="ltag__link">
  <a href="/mcsee" class="ltag__link__link">
    <div class="ltag__link__pic">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ykqWDKUm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://res.cloudinary.com/practicaldev/image/fetch/s--g5itNIDM--/c_fill%2Cf_auto%2Cfl_progressive%2Ch_150%2Cq_auto%2Cw_150/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/366059/d995753c-a4ef-4552-918b-f467838d01f5.png" alt="mcsee">
    </div>
  </a>
  <a href="/mcsee/-refactoring-011-replace-comments-with-tests-27j1" class="ltag__link__link">
    <div class="ltag__link__content">
      <h2>Refactoring 011 - Replace Comments with Tests</h2>
      <h3>Maxi Contieri „Éª Apr 23</h3>
      <div class="ltag__link__taglist">
        <span class="ltag__link__tag">#webdev</span>
        <span class="ltag__link__tag">#beginners</span>
        <span class="ltag__link__tag">#programming</span>
        <span class="ltag__link__tag">#tutorial</span>
      </div>
    </div>
  </a>
</div>


<h1>
  
  
  More Info
</h1>

<p><a href="https://learning.oreilly.com/library/view/clean-code-in/9781838982973">Clean Code In C#</a></p>

<h1>
  
  
  Disclaimer
</h1>

<p>Code Smells are my <a href="https://dev.to/mcsee/i-wrote-more-than-90-articles-on-2021-here-is-what-i-learned-1n3a">opinion</a>.</p>

<h1>
  
  
  Credits
</h1>

<p>Photo by <a href="https://unsplash.com/@ana_essentiels">Ana Essentiels</a> on <a href="https://unsplash.com/photos/Eh6iapfqDzA">Unsplash</a></p>




<blockquote>
<p>The reason we mention comments here is that comments often are used as a deodorant. It's surprising how often you look at thickly commented code and notice that the comments are there because the code is bad. </p>
</blockquote>

<p><em>Martin Fowler</em></p>


<div class="ltag__link">
  <a href="/mcsee" class="ltag__link__link">
    <div class="ltag__link__pic">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ykqWDKUm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://res.cloudinary.com/practicaldev/image/fetch/s--g5itNIDM--/c_fill%2Cf_auto%2Cfl_progressive%2Ch_150%2Cq_auto%2Cw_150/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/366059/d995753c-a4ef-4552-918b-f467838d01f5.png" alt="mcsee">
    </div>
  </a>
  <a href="/mcsee/software-engineering-great-quotes-26ci" class="ltag__link__link">
    <div class="ltag__link__content">
      <h2>Software Engineering Great Quotes</h2>
      <h3>Maxi Contieri „Éª Dec 28 '20</h3>
      <div class="ltag__link__taglist">
        <span class="ltag__link__tag">#codenewbie</span>
        <span class="ltag__link__tag">#programming</span>
        <span class="ltag__link__tag">#quotes</span>
        <span class="ltag__link__tag">#software</span>
      </div>
    </div>
  </a>
</div>





<p>This article is part of the CodeSmell Series.</p>


<div class="ltag__link">
  <a href="/mcsee" class="ltag__link__link">
    <div class="ltag__link__pic">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ykqWDKUm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://res.cloudinary.com/practicaldev/image/fetch/s--g5itNIDM--/c_fill%2Cf_auto%2Cfl_progressive%2Ch_150%2Cq_auto%2Cw_150/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/366059/d995753c-a4ef-4552-918b-f467838d01f5.png" alt="mcsee">
    </div>
  </a>
  <a href="/mcsee/how-to-find-the-stinky-parts-of-your-code-1dbc" class="ltag__link__link">
    <div class="ltag__link__content">
      <h2>How to Find the Stinky parts of your Code</h2>
      <h3>Maxi Contieri „Éª May 21 '21</h3>
      <div class="ltag__link__taglist">
        <span class="ltag__link__tag">#codenewbie</span>
        <span class="ltag__link__tag">#tutorial</span>
        <span class="ltag__link__tag">#codequality</span>
        <span class="ltag__link__tag">#beginners</span>
      </div>
    </div>
  </a>
</div>


 </details> 
 <hr /> 

 #### - [Principles for Scaling Frontend Application Developments](https://dev.to/hashcode01/principles-for-scaling-frontend-application-developments-2kja) 
 <details><summary>Article</summary> <p>Today I decided to note and review the principles that was discussed by Malte UBL from Vercel</p>

<p>Scaling web apps is harder than it seems, both technically and in terms of team growth and iteration.</p>

<p>Technical aspect of making the application performant when reaching millions of users is challenging.</p>

<p>He thinks a lot about scaling and just did a talk on scaling frontend app development on react summit:</p>

<p>Here are six essential principles for scaling applications:</p>

<ul>
<li>1: Tear down the barriers</li>
<li>2: Make it east to delete code </li>
<li>3: Migrate incrementally </li>
<li>4: Always get better, never get worse</li>
<li>5: Embrace lack of knowledge</li>
<li>6: Eliminate systematic complexity</li>
</ul>

<p>Now lets deep into each principle: </p>

<h2>
  
  
  Principle 1: Tear down the barriers
</h2>

<p>The first principle discussed in the video is to tear down the barriers that can slow down development. This includes things like silos between teams, slow build times, and manual processes that can be automated. By removing these barriers, teams can work more efficiently and focus on delivering value to users.</p>

<p>Good example : go migrate to a mono repo that could save a lot of times and removes some barriers </p>

<h2>
  
  
  Principle 2: Make it easy to delete code
</h2>

<p>The second principle is all about making it easy to delete code. This means creating a style system where teams can keep their codebase clean and maintainable.</p>

<p>Good example 1: if you use css-in-js or tailwind, because you have co-location of the css with the code you can easily remove the component with high confidence.<br>
Good example 2: data fetching inside of components in NextJs 13 </p>

<h2>
  
  
  Principle 3: Migrate incrementally
</h2>

<p>The third principle is to migrate incrementally. This means moving from old APIs to new capabilities in a gradual way, By taking an incremental approach, teams can avoid breaking changes and minimize risk.</p>

<p>Indeed he believes there are only 2 types of migrations:</p>

<ul>
<li>incremental migrations</li>
<li>failed migrations </li>
</ul>

<p>Good example 1: Next.js 13 app router <br>
Good example 2: trpc </p>

<h2>
  
  
  Principle 4: Always get better, never get worse
</h2>

<p>The fourth principle is all about continuous improvement. Teams should always be looking for ways to improve their codebase and processes, rather than letting things stagnate. This includes introducing new rules for new code rather than migrating old code, seeking approval for code changes.</p>

<p>Good example: introducing lint rules gradualy</p>

<p>Principle 5: Embrace lack of knowledge<br>
The fifth principle is to embrace a lack of knowledge. This means being comfortable with not knowing everything and seeking out answers when needed. It also means being willing to ask questions and challenge assumptions in order to improve outcomes.</p>

<p>Some Good examples:</p>

<ul>
<li>To reduce any fear of embarrassment, the team establishes an anonymous question submission system</li>
<li>Encouraging employees to ask dumb questions helps create a culture of openness and comfort by doing it yourself</li>
<li>Mentorship and Guidance</li>
</ul>

<h2>
  
  
  Principle 6: Eliminate systematic complexity
</h2>

<p>The final principle is to eliminate systematic complexity. This includes things like versioning APIs and introducing new fields, which can add unnecessary complexity. The speaker proposes using serverless deployment to eliminate this complexity altogether. By simplifying the system, teams can focus on delivering value to users rather than managing complexity.</p>

<p>Good example: versions Skew  </p>

<p><a href="https://youtu.be/tqhLK0Fb5_4?si=Ql-dj-x5w443dEK9">https://youtu.be/tqhLK0Fb5_4?si=Ql-dj-x5w443dEK9</a></p>

<p>let me know in the comments what's your opinion about hese principles and if you have and good examples of each one </p>

<p>All the best<br>
HASH</p>

 </details> 
 <hr /> 
<!-- BLOG-POST-LIST:END -->
</table>
</details>


<!-- TODO
Change the 3stats boxes around, possibly two on top and one on bottom
Fix RSSfeed
Fix Spotify Playlists
Fix Socials [Portfolio, Discord, Linkedin]
In the future, add Public Repositories of Selected Projects
-->
