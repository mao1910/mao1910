<!-- VISITOR BADGE -->
<!-- https://github.com/hehuapei/visitor-badge -->

<img align="right" src="https://visitor-badge.laobi.icu/badge?page_id=mao1910.mao1910&left_color=%2379DAF9&right_color=%23FE6E96" />


<!-- TYPING SVG -->
<!-- https://github.com/DenverCoder1/readme-typing-svg -->

<h1 align="center">
    <img src="https://readme-typing-svg.herokuapp.com/?font=Righteous&size=35&center=true&vCenter=true&width=500&height=70&color=FE6E96&font=poppins&duration=5000&lines=Hi+There!+👋;+I'm+Mao!;" />
</h1>

<br/>

<!-- ABOUT ME TERMINAL -->
<h1 align="center">
<img src="./assets/terminal-5.gif" alt="Terminal" />
</h1>

<br/><br/><br/>


<!-- TECHNOLOGIES LOGOS -->
<!-- https://github.com/tandpfun/skill-icons -->

<h2 align="center">💻 Languages / Frameworks / Tools ⚒️</h2>
<div align="center">
    <img src="https://skillicons.dev/icons?i=javascript,typescript,angular,react,html,css,scss,bootstrap,cs,java,spring" />
    <img src="https://skillicons.dev/icons?i=flutter,firebase,supabase,mysql,git,github,gitlab,vscode,idea,maven,figma" />
</div>

<br/><br/><br/>


<!-- CONTRIBUTIONS SNAKE GAME -->
<!-- https://github.com/Platane/snk -->

<div align="center">
  <h2> My Contributionssss🐍 </h2>
  <br>
  <img alt="contributions-eating Snake" src="https://raw.githubusercontent.com/mao1910/mao1910/output/github-contribution-grid-snake.svg" />

  <!-- Four lines below suggested by Planate for Dark mode-->
  <picture>
  <source media="(prefers-color-scheme: dark)" srcset="github-snake-dark.svg" />
  <source media="(prefers-color-scheme: light)" srcset="github-snake.svg" />
  </picture>
  
  <br/><br/><br/>
</div>


<!-- GITHUB STATS -->
<!-- https://github.com/DenverCoder1/github-readme-streak-stats --> <!--  My own Vercel deployment -->
<!-- https://github.com/anuraghazra/github-readme-stats --> <!--  My own Vercel -->

<h2 align="center"> Stats📝 </h2>
  <br>
<div align=center>
  <img width=429 src="https://github-readme-stats-mao1910.vercel.app/api?username=mao1910&count_private=true&show_icons=true&theme=dracula&rank_icon=github&hide=contribs&border_radius=10&border_color=79DAF9" alt="github stats"/>
  <img width=396 src="https://github-readme-streak-stats-2235.vercel.app?user=mao1910&count_private=true&theme=dracula&currStreakNum=79DAF9&currStreakLabel=FE6E96&border_radius=10&border=79DAF9" alt="streak stats"/>
  <br/>
  <img src="https://github-readme-stats-mao1910.vercel.app/api/top-langs/?username=mao1910&layout=compact&theme=dracula&border_radius=10&size_weight=0.5&count_weight=0.5&border_color=79DAF9" alt="languages stats" />
</div>

<br/><br/><br/>


<!-- FOOTER -->
<!-- https://github.com/DenverCoder1/readme-typing-svg -->
<!-- https://readme-typing-svg.demolab.com/demo/ -->

<a href="https://git.io/typing-svg"><img src="https://readme-typing-svg.demolab.com?font=Poppins&pause=1000&color=FE6E96&width=535&lines=Thanks+for+dropping+by!;Feel+free+to+check+any+of+the+Socials+below+%F0%9F%91%87;Or+the+Joke+Of+The+Day+if+you're+down+for+a+giggle+%F0%9F%98%9D;Hope+to+see+you+again+%F0%9F%91%8A;Uh%3F+You're+still+here%3F;Well...+I'm+running+out+of+things+to+say...;Tell+you+what%2C+due+to+your+effort+and+perseverance%2C;I+shall+present+you+with+a+short+poem%3A;%22To+code%2C+or+not+to+code%2C+that+is+the+question%3A;Whether+'tis+nobler+in+the+IDE+to+debug;The+errors+and+issues+of+outrageous+software%2C;Or+to+take+up+the+keyboard+against+a+sea+of+bugs;And+by+coding%2C+end+them.%22;by+William+Shakespeare%2C+probably.+;Pretty+sure+that's+Hamlet's.;Alrighty%2C+this+has+been+fun.;But+I'll+restart+the+loop+now...+see+ya+soon!" alt="Typing SVG" /></a>


<!--  SOCIAL NETWORKS -->
<!-- https://github.com/alexandresanlim/Badges4-README.md-Profile -->

  <div> 
    <a href="https://www.deviantart.com/madeinkobaia/art/my-profile-is-under-construction-265626465" target="_blank"><img src="https://img.shields.io/badge/-LinkedIn-%230077B5?style=for-the-badge&logo=linkedin&logoColor=white" target="_blank"></a> <!-- ADD LINKEDIN PROFILE -->
    <a href = "https://www.nicepng.com/ourpic/u2q8o0t4t4r5o0r5_website-under-construction-png-graphic-transparent-website-under/"><img src="https://img.shields.io/badge/Portfolio-4285F4?style=for-the-badge&logo=Google-chrome&logoColor=white" target="_blank"></a> <!-- ADD PORTFOLIO WEBSITE -->
    <a href="https://discord.gg" target="_blank"><img src="https://img.shields.io/badge/Discord-7289DA?style=for-the-badge&logo=discord&logoColor=white" target="_blank"></a> <!-- ADD DISCORD --> <!-- User or Server? -->
    <a href = "mailto:mao1910dev@gmail.com"><img src="https://img.shields.io/badge/Gmail-D14836?style=for-the-badge&logo=gmail&logoColor=white" target="_blank"></a>
  </div>


<!-- SPOTIFY PLAYING-->
<!-- https://github.com/novatorem/novatorem --> <!-- My own Vercel deployment-->

[<img width=438px src="https://spotify-now-playing-git-main-mao1910.vercel.app//api/spotify/?border_color=FE6E96" alt="Mao Spotify Now Playing" />](https://open.spotify.com/user/31542et242zglhf42ydrtqgvuvde)


<!-- JOKE OF THE DAY -->
<!-- https://github.com/ABSphreak/readme-jokes --> <!-- My own Vercel deployment-->

<details>
<summary>I've got a Joke for you. Wanna hear it? 🙈</summary>

<br/>

 <tr>
 <td style="padding-top:4px"><img src = "https://readme-jokes-git-master-mao1910.vercel.app/api?&theme=dracula"></td>
 </tr>

</details>


<!-- RSS FEED -->
<!-- https://github.com/gautamkrishnar/blog-post-workflow -->

<details>
<summary>📕 &nbsp;RSS feed</summary>

<br/>

<!-- BLOG-POST-LIST:START -->
 #### - [Breaking Terraform files into composable layers](https://dev.to/he4rt/breaking-terraform-files-into-composable-layers-1mj8) 
 <details><summary>Article</summary> <p>Terraform allows you to spin up cloud infrastructure using a single command. Let's say you're trying to run Elasticsearch and Kibana within a Kubernetes cluster, for example.</p>

<p>For that, you could write a few <code>.tf</code> files and run <code>terraform apply</code> to provision a Kubernetes cluster and deploy a few pods to it.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--M2tay2Bu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gcuyfxzx1putejr1rl8t.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--M2tay2Bu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gcuyfxzx1putejr1rl8t.png" alt="Image description" width="800" height="716"></a></p>

<p>Now, assume you want other instances of the Elastic stack that you can use for demos. In that case, you'll have to set up brand new <a href="https://developer.hashicorp.com/terraform/language/state/workspaces">Terraform workspaces</a> and run <code>terraform apply</code> multiple times.</p>

<p>The problem with this approach is that it will cause you to replicate your <em>entire</em> infrastructure every time. Consequently, you'll have multiple Kubernetes clusters. Each cluster takes at least 15 minutes to spin up and costs $72 a month on AWS.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--FtQxQhRb--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/hxcjdv5zbm87e5hqrdpf.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--FtQxQhRb--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/hxcjdv5zbm87e5hqrdpf.png" alt="Image description" width="800" height="294"></a></p>

<p>A much better alternative would be to reuse a single Kubernetes cluster and spin up multiple environments on top of it. Thus, you'd pay for a single cluster, and you don't have to wait for a brand new cluster every time you spawn a new environment.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--OYZBQaOm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/dm7mo4o6ub7y1w0mw6xj.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--OYZBQaOm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/dm7mo4o6ub7y1w0mw6xj.png" alt="Image description" width="800" height="280"></a></p>

<p>That's why <a href="https://github.com/ergomake/layerform">Layerform</a> exists. Layerform allows engineers to break their Terraform files into composable <em>layers</em>. That way, teams can have a shared base layer for their Kubernetes cluster and multiple top layers with Elasticsearch, Kibana, and even other serverless components they need, like Lambdas, SQS queues, or load balancers.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--5PlYKotr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ap5kps52rrkjqw09hlj5.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5PlYKotr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ap5kps52rrkjqw09hlj5.png" alt="Image description" width="800" height="482"></a></p>

<p>In this post, I'll explain how layers work, how to break your Terraform files into composable layers and demonstrate a few use cases that layers enable. Those use cases include creating production-like development environments and setting up pull request preview links for <em>any</em> type of application.</p>

<blockquote>
<p>As a note, Terraform workspaces are quite laborious to use. The official documentation even contains a warning about using them.<br>
<em><strong>Important</strong>: Workspaces are not appropriate for system decomposition or deployments requiring separate credentials and access controls.</em></p>
</blockquote>



<h2>
  
  
  How layers work
</h2>

<p>In Layerform, Terraform files are divided into layers. Each layer definition specifies the files that belong to it and a list of dependencies.</p>

<p>Let's say you're trying to run Elasticsearch and Kibana within an EKS instance (AWS-managed k8s).</p>

<p>For that, you'd have two layers, one for <code>eks</code>, and another for the <code>elastic_stack</code>.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"layers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eks"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"files"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"layers/eks.tf"</span><span class="p">,</span><span class="w"> </span><span class="s2">"layers/eks/**"</span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"elastic_stack"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"files"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"layers/elastic_stack.tf"</span><span class="p">,</span><span class="w"> </span><span class="s2">"layers/elastic_stack/**"</span><span class="p">],</span><span class="w">
            </span><span class="nl">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"eks"</span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

</div>



<p>In the <code>eks</code> layer definition, you specify which files belong to that layer. Given that <code>eks</code> does <em>not</em> depend on any other infrastructure, it won't list any other layers as dependencies. On the other hand, the <code>elastic_stack</code> layer's files depend on <code>eks</code>. Consequently, it will include <code>eks</code> as a dependency.</p>

<p>After defining layers this way, you can spin up an EKS cluster independently by running <code>layerform spawn eks default</code>.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--FkvApNvc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ypdqh69w89w46ykwhwqq.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--FkvApNvc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ypdqh69w89w46ykwhwqq.png" alt="Image description" width="800" height="118"></a></p>

<p>Then, each engineer can create their own instances of the <code>elastic_stack</code> and reuse the same cluster. For that, they'd all run <code>layerform spawn elastic_stack &lt;name&gt;</code>, and each of these layers would look for an underlying <code>eks</code> layer with ID <code>default</code>.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--8P7X6B_B--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/9s8v5628ww5himz8irzy.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--8P7X6B_B--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/9s8v5628ww5himz8irzy.png" alt="Image description" width="800" height="486"></a><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>➜ layerform list instances
INSTANCE NAME                LAYER NAME    DEPENDENCIES
default                      eks
first                        elastic_stack  eks=default
second                       elastic_stack  eks=default
</code></pre>

</div>



<p>If someone needs a new cluster, they can recreate the whole stack by passing the <code>--base</code> flag, as in <code>layerform spawn elastic_stack third --base eks=another_eks</code>.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--nVvBa9_U--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/7gvyssbz2m54d2xl01d7.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--nVvBa9_U--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/7gvyssbz2m54d2xl01d7.png" alt="Image description" width="800" height="323"></a><br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>➜ layerform list instances
INSTANCE NAME                LAYER NAME    DEPENDENCIES
default                      eks
another_eks                  eks
first                        elastic_stack  eks=default
second                       elastic_stack  eks=default
third                        elastic_stack  eks=another_eks
</code></pre>

</div>



<p>When done with their layers, engineers can kill their layer instances without damaging someone else's work.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--9RcCxzV0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/pwd33a7q2x1hk0uaaiwl.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--9RcCxzV0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/pwd33a7q2x1hk0uaaiwl.png" alt="Image description" width="800" height="419"></a></p>

<p>In a way, Layerform's layers are similar to container layers. Some people refer to them as "Kustomize for Terraform."</p>



<h2>
  
  
  Using layers to create development environments
</h2>

<p>For most teams, "staging" is a bottleneck. Usually, companies have many engineers, but there's only a single "staging" environment for everyone to use. Consequently, developers wanting to test changes in a production-like environment must queue.</p>

<p>Additionally, when systems are large or depend on serverless components, engineers cannot reliably run all their software on their machines. Therefore, they all point to the same staging environment and step on each others' toes.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--h2ZZ-wVs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/dn62yxb4ac16mziqizlk.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--h2ZZ-wVs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/dn62yxb4ac16mziqizlk.png" alt="Image description" width="800" height="377"></a></p>

<p>Layers help teams solve this problem by enabling each engineer to spin up their own environment and share core pieces of infrastructure, as shown earlier.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--1t0giuY3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/vr8ktr4zhtfrxblrl2ty.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--1t0giuY3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/vr8ktr4zhtfrxblrl2ty.png" alt="Image description" width="800" height="421"></a></p>

<p>Layerform also provides developers valuable features to develop applications locally while pointing them to their own "staging" environment's back-end.</p>

<p>Assume you cannot run Elasticsearch locally because the JVM needs too much memory, for example. In that case, you could use <code>layerform output</code> to get the address of your remote Elasticsearch instance.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>➜ layerform output elastic_stack first

{
  "cluster_name": {
    "sensitive": false,
    "type": "string",
    "value": "demo-eks-post-example"
  },
  "elasticsearch_url": {
    "sensitive": false,
    "type": "string",
    "value": "https://elasticsearch-post-example.environment.ergomake.link"
  }
}
</code></pre>

</div>



<p>You could use that URL in your Kibana configuration file (<code>config.yml</code>). That way, you could point your local Kibana to the remote Elasticsearch as you develop.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight yaml"><code><span class="na">elasticsearch.hosts</span><span class="pi">:</span>
    <span class="pi">[</span><span class="s2">"</span><span class="s">https://elasticsearch-post-example.environment.ergomake.link"</span><span class="pi">]</span>
</code></pre>

</div>



<p>In case you had multiple outputs you need to interpolate in your configuration file, as many applications have, you could even write a template file and tell Layerform to interpolate it for you.</p>

<p>Take the following template file for Kibana's <code>config.yml</code>, for example.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight yaml"><code><span class="na">elasticsearch.hosts</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">{{elasticsearch_url.value}}"</span><span class="pi">]</span>
</code></pre>

</div>



<p>To render that file and replace <code>{{ elasticsearch_url.value }}</code> with the actual values for your particular layer, you could use the <code>--template</code> flag to output the rendered file to <code>stdout</code>.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight yaml"><code><span class="s">➜ layerform output elastic_stack first --template config/kibana-template.yml</span>

<span class="na">elasticsearch.hosts</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">http://elastic-stack-xehl-es.environment.ergomake.link'</span><span class="pi">]</span>
</code></pre>

</div>



<p>Engineers could then pipe the rendered file to an actual <code>config.yml</code> and use it without knowing anything about layers or manually entering values.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight yaml"><code><span class="s">➜ layerform output elastic_stack first --template config/kibana-template.yml &gt; config.yml</span>
</code></pre>

</div>



<p>After that, <code>yarn start</code> would cause Kibana to read <code>config.yml</code> and point to the remote Elasticsearch.</p>



<h3>
  
  
  A note on collaborating with layers
</h3>

<p>Similarly to Terraform, Layerform may use a remote back-end to store states and layer definitions.</p>

<p>Once an engineer creates a layer instance, Layerform syncs it with a remote state file in S3. Then, when someone else uses <code>layerform list instances</code>, Layerform will fetch states from the remote back-end and list an up-to-date list of instances.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--8adkbuS2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/38dvovqdoplf7l9z1j4z.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--8adkbuS2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/38dvovqdoplf7l9z1j4z.png" alt="Image description" width="800" height="284"></a></p>

<p>Assume engineer A spun up layer <code>first</code>. If engineer B wants to collaborate with engineer A, they will be able to see <code>first</code> in the list of layers because the list is stored remotely.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code># Ran by engineer B
➜ layerform list instances

INSTANCE NAME                LAYER NAME     DEPENDENCIES
default                      eks
first                        elastic_stack  eks=default
</code></pre>

</div>



<p>Then, engineer B can also get the URL of the Elasticsearch instance in layer <code>first</code> by running <code>layerform output</code>.</p>

<blockquote>
<p>We're still working on proper locking and collaboration mechanisms to keep states free of race conditions. We welcome pull requests for that in case you're interested in contributing.</p>
</blockquote>



<h2>
  
  
  Using layers to create pull request previews
</h2>

<p>Whenever engineers make changes and open a pull request, Vercel spins up their Next.js application and adds a preview link to the PR.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--pnjyN5Og--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1ssnxqyr3p3pxlah6inw.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--pnjyN5Og--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/1ssnxqyr3p3pxlah6inw.png" alt="Image description" width="800" height="237"></a></p>

<p>Most developers, designers, and product managers love Vercel's previews. <strong>The problem is that these previews do not work for teams with more complex set-ups</strong>. For example, you can't get full-stack previews if you have a serverless application or need a Kubernetes cluster.</p>

<p>Today, most teams end up building these preview environments in-house, using a bunch of ad-hoc scripts.</p>

<p><a href="https://github.com/ergomake/layerform">Layerform</a> helps teams solve this problem by allowing them to create a separate preview layer. Then, engineers can call the Layerform CLI from their CI and spin up only the infrastructure they need.</p>

<p>Since Layerform uses Terraform files, it can spin up all types of infrastructure for these previews, including Kubernetes resources, Lambdas, SQS instances, and S3 buckets.</p>

<p>In the case of the Elastic stack, for example, engineers could create a GitHub action to <code>layerform spawn</code> only the Elastic stack layer on top of a shared <code>preview</code> cluster, making previews much less expensive.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight yaml"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Preview</span>

<span class="na">on</span><span class="pi">:</span>
    <span class="na">pull_request</span><span class="pi">:</span>

<span class="na">jobs</span><span class="pi">:</span>
    <span class="na">preview</span><span class="pi">:</span>
        <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

        <span class="na">steps</span><span class="pi">:</span>
            <span class="c1"># + Checkout code, install deps, etc...</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Layerform</span>
              <span class="na">run</span><span class="pi">:</span> <span class="s">go install github.com/ergomake/layerform@main</span>

            <span class="c1"># Configure remote state — we'll improve this</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create Layerform config file</span>
              <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
                  <span class="s">mkdir -p ~/.layerform</span>
                  <span class="s">echo "currentContext: demo" &gt; ~/.layerform/config</span>
                  <span class="s">echo "contexts:" &gt;&gt; ~/.layerform/config</span>
                  <span class="s">echo "  demo:" &gt;&gt; ~/.layerform/config</span>
                  <span class="s">echo "    type: s3" &gt;&gt; ~/.layerform/config</span>
                  <span class="s">echo "    bucket: layerform-post-demo" &gt;&gt; ~/.layerform/config</span>
                  <span class="s">echo "    region: us-west-1" &gt;&gt; ~/.layerform/config</span>

            <span class="c1"># Actually spawn the preview layer</span>
            <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">layerform</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">Spawn Elasticstack using Layerform</span>
              <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
                  <span class="s">layerform spawn elastic_stack ${{ github.event.pull_request.head.ref }}</span>
              <span class="na">env</span><span class="pi">:</span>
                  <span class="na">AWS_ACCESS_KEY_ID</span><span class="pi">:</span> <span class="s">${{ secrets.AWS_ACCESS_KEY_ID }}</span>
                  <span class="na">AWS_SECRET_ACCESS_KEY</span><span class="pi">:</span> <span class="s">${{ secrets.AWS_SECRET_ACCESS_KEY }}</span>
</code></pre>

</div>



<p>The workflow above will use the pull request's branch name as the layer instance's name.</p>

<blockquote>
<p>Just like any other layer instance, it will appear when running <code>layerform list</code>, so you can connect to it from your terminal too, if you want.</p>
</blockquote>

<p>Finally, once the <code>spawn</code> is done, you can write some code to call <code>layerform output</code> and add a comment with a preview link to the pull request.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight yaml"><code><span class="c1"># ...</span>

<span class="c1"># Get Kibana's URL from layerform output using jq</span>
<span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">layerform</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">Spawn Elasticstack using Layerform</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">layerform spawn elastic_stack ${{ github.event.pull_request.head.ref }}</span>
      <span class="s">kibana=$(layerform output elastic_stack ${{ github.event.pull_request.head.ref }} | jq -r .kibana_url.value)</span>
      <span class="s">echo "kibana=$kibana" &gt;&gt; "$GITHUB_OUTPUT"</span>
  <span class="na">env</span><span class="pi">:</span>
      <span class="na">AWS_ACCESS_KEY_ID</span><span class="pi">:</span> <span class="s">${{ secrets.AWS_ACCESS_KEY_ID }}</span>
      <span class="na">AWS_SECRET_ACCESS_KEY</span><span class="pi">:</span> <span class="s">${{ secrets.AWS_SECRET_ACCESS_KEY }}</span>

<span class="c1"># Add a comment to the pull request</span>
<span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v6</span>
  <span class="na">with</span><span class="pi">:</span>
      <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">github.rest.issues.createComment({</span>
            <span class="s">issue_number: context.issue.number,</span>
            <span class="s">owner: context.repo.owner,</span>
            <span class="s">repo: context.repo.repo,</span>
            <span class="s">body: '${{ steps.layerform.outputs.kibana }}'</span>
          <span class="s">})</span>
</code></pre>

</div>



<p>After that change, you'll see a preview link pointing to actual production-like infrastructure in every PR you open.</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--RLVL_0X0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tfarsc0kamv6bumhubfx.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--RLVL_0X0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tfarsc0kamv6bumhubfx.png" alt="Image description" width="800" height="139"></a></p>

<p>To destroy these layer instances, you should create a second workflow that's triggered when someone closes or merges a PR. That workflow should call <code>layerform kill</code> and pass it the layer's name, which, in this case, is the same as the branch's.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight yaml"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Destroy previews when PRs are closed</span>

<span class="na">on</span><span class="pi">:</span>
    <span class="na">pull_request</span><span class="pi">:</span>
        <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">closed</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
    <span class="na">kill_preview</span><span class="pi">:</span>
        <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
        <span class="na">steps</span><span class="pi">:</span>
            <span class="c1"># + Checkout code, install deps, etc...</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Layerform</span>
              <span class="na">run</span><span class="pi">:</span> <span class="s">go install github.com/ergomake/layerform@main</span>

            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Kill preview</span>
              <span class="na">run</span><span class="pi">:</span> <span class="s">layerform kill elastic_stack ${{ github.event.pull_request.head.ref }}</span>
</code></pre>

</div>



<h2>
  
  
  Extra implementation notes
</h2>

<p>In these examples, I assume that users have deployed an <a href="https://docs.nginx.com/nginx-ingress-controller/"><code>nginx-ingress-controller</code></a> to their cluster through the <code>eks</code> layer. This controller is responsible for creating an <code>nlb</code> and exposing Elasticsearch and Kibana to the internet through their ingresses.</p>

<p>In any case, many developers would probably want to keep their development environments within a VPN, which is also possible because Layerform provisions all the infrastructure in <em>your</em> cloud using plain Terraform files.</p>

<p>When it comes to deploying the actual pods to your cluster, you can use whatever you want. When I tested the examples myself, I specified raw Kubernetes resources through the <code>kubernetes</code> provider. Still, you could use Helm charts with the Helm provider. The only requirement for using layers is that your infra is in a Terraform file, not ad-hoc scripts.</p>

<p>Finally, another interesting detail is that engineers must provide layer definitions to the remote back-end with <code>layerform configure</code> before anyone can spawn instances.</p>

<p><strong>If you've found this idea intriguing, please consider <a href="https://github.com/ergomake/layerform">giving us a star on GitHub</a>.</strong></p>

 </details> 
 <hr /> 

 #### - [AWS Lambda and Slack integration](https://dev.to/aws-builders/aws-lambda-and-slack-integration-2d3g) 
 <details><summary>Article</summary> <p>Slack has emerged as a go-to platform for businesses to promote effective interactions because it is essential for seamless team collaboration. You can streamline the process of sending Slack messages and seamlessly integrate it into your current workflows by utilising the strength of AWS Lambda functions. In this article, we’ll look at how to send Slack messages and easily add them to your team’s Slack channels using a Python Lambda function.</p>

<h2>
  
  
  Step 1: Create a Slack App and obtain credentials
</h2>

<p>You must create a Slack app and obtain the required authentication credentials before you can begin. Create a new app for your workspace using the Slack API, then enable the necessary permissions, such as “chat:write.” We will need your app’s API token later, so please retrieve it.</p>

<p>I personally prefer using the <a href="https://api.slack.com/messaging/webhooks">incoming webhooks</a> feature that Slack provides. It will give you a simple REST api to send messages. See the example below.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight shell"><code>POST https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX
Content-type: application/json
<span class="o">{</span>
    <span class="s2">"text"</span>: <span class="s2">"Hello, world."</span>
<span class="o">}</span>
</code></pre>

</div>



<h2>
  
  
  Step 2: Set Up an AWS Lambda Function
</h2>

<p>Go to the Lambda service in the AWS Management Console and select “Create Function.” Select the proper runtime environment for your Lambda function that is based on Python.</p>

<p>Write the Python code necessary to send Slack messages in the Lambda function’s code editor. Import the requests library to get started with sending HTTP requests to the Slack API. Create a function that builds the message payload and sends it to the correct Slack API endpoint after that.</p>

<p>Here is an example of what Python code could look like:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">send_slack_message</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
    <span class="n">slack_token</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="s">'SLACK_TOKEN'</span><span class="p">]</span>
    <span class="n">channel_id</span> <span class="o">=</span> <span class="s">'your_channel_id'</span>

    <span class="n">url</span> <span class="o">=</span> <span class="s">'https://slack.com/api/chat.postMessage'</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Authorization'</span><span class="p">:</span> <span class="sa">f</span><span class="s">'Bearer </span><span class="si">{</span><span class="n">slack_token</span><span class="si">}</span><span class="s">'</span><span class="p">}</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'channel'</span><span class="p">:</span> <span class="n">channel_id</span><span class="p">,</span>
        <span class="s">'text'</span><span class="p">:</span> <span class="n">message</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Message sent successfully!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Failed to send message."</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s">"Hello from AWS Lambda!"</span>
    <span class="n">send_slack_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

</code></pre>

</div>



<p>As soon as you configure your Lambda function, make sure to replace <code>your_channel_id</code> with the appropriate Slack channel ID and set the <code>SLACK_TOKEN</code> environment variable.</p>

<h2>
  
  
  Step 4: Configure the Lambda Function
</h2>

<p>Configure the triggers and permissions of the Lambda function to integrate it with Slack. There are many triggers you can set up, including a scheduled event, an API Gateway endpoint, and other AWS services. We’ll concentrate on a simple setup without any particular triggers for this example.</p>

<p>Here is an example of <a href="https://medium.com/@kasun.dsilva/trigger-lambda-functions-via-eventbrigde-172026492121">scheduling Lambda with EventBridge</a>.</p>

<p>Make sure the Lambda function has the appropriate rights to call the Slack API. To enable the Lambda function to send HTTP requests to the Slack API and, if necessary, access other necessary resources, create an IAM role with the proper policies.</p>

<h2>
  
  
  Step 5: Test and Deploy
</h2>

<p>It’s time to test the integration after configuring the Lambda function. To execute the function and make sure it successfully sends a message to your Slack channel, use the Lambda console’s <code>Test</code> feature.</p>

<p>Deploy the Lambda function once you are happy with the implementation.</p>

<p>Slack integration with Python Lambda functions offers a seamless way to communicate with your team or organisation. You can quickly set up a Lambda function to send Slack messages by following the instructions in this blog post, and you can easily integrate it into your current workflows. Utilise Slack and AWS Lambda to your advantage to increase output while fostering effective team communication.</p>

 </details> 
 <hr /> 

 #### - [We Updated Our "Year Club" Badges!](https://dev.to/devteam/we-updated-our-year-club-badges-1lhi) 
 <details><summary>Article</summary> <p>We have been very pleased to add a few new badges to our repertoire as of late, including the <a href="https://dev.to/devteam/announcing-the-icebreaker-badge-20k3">Icebreaker</a> and <a href="https://dev.to/devteam/introducing-the-warm-welcome-badge-4hnh">Warm Welcome</a> Badges. During our excitement around creating new badges, we thought it was high time to present a little makeover to some older badges!</p>

<h2>
  
  
  Introducing... our new "Year Club" Badges!
</h2>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--I4bYKP6H--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/z8ip33gohl49ox5qh2je.jpg" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--I4bYKP6H--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/z8ip33gohl49ox5qh2je.jpg" alt="Year Club Badges" width="800" height="457"></a></p>

<p><strong>These badges are awarded upon your yearly anniversary of becoming a DEV member and were built to celebrate your longevity on our platform.</strong> </p>

<p>If you already earned any Year Club badges, they are now updated to this new look, to help match the rest of our brand identity here on our platform.</p>

<p>Also, as we continue to update our badges, you may notice that the more you engage, the more you unlock new badges! When you stay active on DEV, we hope you are: (1) fulfilled by our community (2) being recognized for how much your participation and knowledge helps make DEV a better place.</p>




<p>We hope you all enjoy our badge refreshes and will see you again soon for more badge updates! </p>

<p>PS: Don't forget to check out our new <a href="https://dev.to/community-badges">Community Badge Page</a> to view all of the other badges we have available on our site.</p>

<p><strong>Cheers,</strong><br>
<strong>The DEV Team</strong></p>

 </details> 
 <hr /> 

 #### - [Hello, world!](https://dev.to/ilya0x/hello-world-jl7) 
 <details><summary>Article</summary> <p>My first post on <a href="https://dev.to">dev.to</a> 🤓</p>

 </details> 
 <hr /> 

 #### - [Discussion of the Week - v2](https://dev.to/devteam/discussion-of-the-week-v2-517c) 
 <details><summary>Article</summary> <p>In this weekly roundup, we highlight what we believe to be the most thoughtful, helpful, and/or interesting discussion over the past week! Though we are strong believers in healthy and respectful debate, we typically try to choose discussions that are positive in nature and avoid those that are overly contentious.</p>

<p>Any folks whose articles we feature here will be rewarded with our Discussion of the Week badge. ✨</p>

<p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--6M-JeZHe--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yvizv31dpchucxic2lxc.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--6M-JeZHe--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yvizv31dpchucxic2lxc.png" alt="The Discussion of the Week badge. It includes a roll of thread inside a speech bubble. The thread is a reference to comment threads." width="800" height="800"></a></p>

<p>Now that y'all understand the flow, let's go! 🏃💨</p>

<h2>
  
  
  The Discussion of the Week
</h2>

<p>This week's pick goes to Keit (<a class="mentioned-user" href="https://dev.to/k8adev">@k8adev</a>) for sharing the enlightening discussion <a href="https://dev.to/k8adev/tech-events-are-not-as-cool-as-you-think-from-an-organizer-perspective-2b70">"Tech Events are NOT as cool as you think (from an organizer perspective)"</a>:</p>


<div class="ltag__link">
  <a href="/k8adev" class="ltag__link__link">
    <div class="ltag__link__pic">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Y28dLDsJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_800/https://res.cloudinary.com/practicaldev/image/fetch/s--NJCLzM31--/c_fill%2Cf_auto%2Cfl_progressive%2Ch_150%2Cq_auto%2Cw_150/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/783676/433bcb84-1773-4d9f-93f4-801568e07efb.jpeg" alt="k8adev">
    </div>
  </a>
  <a href="/k8adev/tech-events-are-not-as-cool-as-you-think-from-an-organizer-perspective-2b70" class="ltag__link__link">
    <div class="ltag__link__content">
      <h2>Tech Events are NOT as cool as you think (from an organizer perspective)</h2>
      <h3>Keit Oliveira ・ Sep 13</h3>
      <div class="ltag__link__taglist">
        <span class="ltag__link__tag">#discuss</span>
        <span class="ltag__link__tag">#techtalks</span>
        <span class="ltag__link__tag">#braziliandevs</span>
        <span class="ltag__link__tag">#frontend</span>
      </div>
    </div>
  </a>
</div>


<p>Many of us in this community are familiar with tech events — developer conferences and meetups... we go, we mingle, we see the talks, eat the snacks, browse the booths and collect way more swag than we ever needed. And, speaking for myself, I generally have a really good time at these events! It gives me a chance to step away from the screen and connect with other tech folks in the real-world. But rarely do I think about the people behind the scenes making these events work.</p>

<p>Keit's post reveals what it's like to put together these events from the organizer's perspective — just how much planning, prep time, and financial costs go into executing a successful event. It's easy to take for granted all the hard work that these organizers do to put on a good show... and they do <strong>a lot!</strong></p>

<p>It was really heartening to see all the kind comments dropped in response to this post. Clearly, Keit's perspective opened many of our eyes to the difficulties organizers face, and lots of y'all hopped in to share your appreciation for these challenges and for the excellent conferences that organizers have put together. Notably, quite a few fellow organizers hopped in to concur and share their own accounts of organizing events. Appreciate all the positive vibes in this comment thread. 😀</p>

<p>Thanks for pulling back the curtain and showing us what it's like to run a tech event like this, Keit! Organizing events is no easy task, but it's important to and much appreciated by us folks that attend.</p>

<h2>
  
  
  What are your picks?
</h2>

<p>The DEV Community is particularly special because of the kind, thoughtful, helpful, and entertaining discussions happening between community members. As such, we want to encourage folks to participate in discussions and reward those who are initiating or taking part in conversations across the community. After all, a community is made possible by the people interacting inside it.</p>

<p>There are loads of great discussions floating about in this community. This just the one we chose to highlight. 🙂</p>

<p>I urge you all to share your favorite discussion of the past week below in the comments. And if you're up for it, give the author an @mention — it'll probably make 'em feel good. 💚</p>

 </details> 
 <hr /> 
<!-- BLOG-POST-LIST:END -->
</table>
</details>


<!-- TODO
Change the 3stats boxes around, possibly two on top and one on bottom
Fix RSSfeed
Fix Spotify Playlists
Fix Socials [Portfolio, Discord, Linkedin]
In the future, add Public Repositories of Selected Projects
-->
